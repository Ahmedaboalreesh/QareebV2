<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± ØªÙƒØ§Ù…Ù„ Firebase - Ø´Ø§Ø±Ùƒ Ø³ÙŠØ§Ø±ØªÙƒ</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <i class="fas fa-car"></i>
                    <span>Ø´Ø§Ø±Ùƒ Ø³ÙŠØ§Ø±ØªÙƒ</span>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="test-firebase-integration.html" class="active">Ø§Ø®ØªØ¨Ø§Ø± Firebase</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Test Section -->
    <section class="test-section">
        <div class="container">
            <div class="test-header">
                <h1>Ø§Ø®ØªØ¨Ø§Ø± ØªÙƒØ§Ù…Ù„ Firebase</h1>
                <p>Ø£Ø¯Ø§Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ ÙˆØ¸Ø§Ø¦Ù Firebase ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
            </div>

            <!-- Firebase Status -->
            <div class="status-section">
                <h3>Ø­Ø§Ù„Ø© Firebase</h3>
                <div class="status-grid">
                    <div class="status-card" id="firebaseStatus">
                        <i class="fas fa-fire"></i>
                        <div class="status-content">
                            <span class="status-label">Ø­Ø§Ù„Ø© Firebase</span>
                            <span class="status-value">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span>
                        </div>
                    </div>
                    <div class="status-card" id="authStatus">
                        <i class="fas fa-user-check"></i>
                        <div class="status-content">
                            <span class="status-label">Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</span>
                            <span class="status-value">ØºÙŠØ± Ù…ØªØµÙ„</span>
                        </div>
                    </div>
                    <div class="status-card" id="databaseStatus">
                        <i class="fas fa-database"></i>
                        <div class="status-content">
                            <span class="status-label">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                            <span class="status-value">ØºÙŠØ± Ù…ØªØµÙ„</span>
                        </div>
                    </div>
                    <div class="status-card" id="storageStatus">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <div class="status-content">
                            <span class="status-label">Ø§Ù„ØªØ®Ø²ÙŠÙ†</span>
                            <span class="status-value">ØºÙŠØ± Ù…ØªØµÙ„</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Authentication Tests -->
            <div class="test-category">
                <h3>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</h3>
                <div class="test-grid">
                    <div class="test-card">
                        <h4>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ</h4>
                        <div class="test-form">
                            <input type="email" id="testEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" value="test@example.com">
                            <input type="password" id="testPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value="123456">
                            <select id="testUserType">
                                <option value="renter">Ù…Ø³ØªØ£Ø¬Ø±</option>
                                <option value="owner">ØµØ§Ø­Ø¨ Ø³ÙŠØ§Ø±Ø©</option>
                            </select>
                            <button class="btn btn-primary" onclick="testCreateUser()">
                                <i class="fas fa-user-plus"></i>
                                Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
                            </button>
                        </div>
                    </div>

                    <div class="test-card">
                        <h4>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h4>
                        <div class="test-form">
                            <input type="email" id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                            <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                            <button class="btn btn-success" onclick="testLogin()">
                                <i class="fas fa-sign-in-alt"></i>
                                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                            </button>
                        </div>
                    </div>

                    <div class="test-card">
                        <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</h4>
                        <div class="user-info" id="currentUserInfo">
                            <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
                        </div>
                        <button class="btn btn-outline" onclick="testGetCurrentUser()">
                            <i class="fas fa-user"></i>
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
                        </button>
                    </div>

                    <div class="test-card">
                        <h4>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</h4>
                        <button class="btn btn-danger" onclick="testLogout()">
                            <i class="fas fa-sign-out-alt"></i>
                            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </div>
            </div>

            <!-- Database Tests -->
            <div class="test-category">
                <h3>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                <div class="test-grid">
                    <div class="test-card">
                        <h4>Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h4>
                        <div class="test-form">
                            <input type="text" id="carBrand" placeholder="Ø§Ù„Ù…Ø§Ø±ÙƒØ©" value="ØªÙˆÙŠÙˆØªØ§">
                            <input type="text" id="carModel" placeholder="Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„" value="ÙƒØ§Ù…Ø±ÙŠ">
                            <input type="number" id="carYear" placeholder="Ø§Ù„Ø³Ù†Ø©" value="2022">
                            <input type="number" id="carPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ" value="150">
                            <textarea id="carDescription" placeholder="Ø§Ù„ÙˆØµÙ">Ø³ÙŠØ§Ø±Ø© Ù…Ù…ØªØ§Ø²Ø© Ù„Ù„Ø§Ø³ØªØ¦Ø¬Ø§Ø±</textarea>
                            <button class="btn btn-primary" onclick="testCreateCar()">
                                <i class="fas fa-car"></i>
                                Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø©
                            </button>
                        </div>
                    </div>

                    <div class="test-card">
                        <h4>Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h4>
                        <div class="cars-list" id="carsList">
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª</p>
                        </div>
                        <button class="btn btn-outline" onclick="testGetCars()">
                            <i class="fas fa-list"></i>
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </button>
                    </div>

                    <div class="test-card">
                        <h4>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² ØªØ¬Ø±ÙŠØ¨ÙŠ</h4>
                        <div class="test-form">
                            <input type="text" id="bookingCarId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
                            <input type="date" id="startDate" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©">
                            <input type="date" id="endDate" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©">
                            <input type="number" id="totalPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" value="300">
                            <button class="btn btn-primary" onclick="testCreateBooking()">
                                <i class="fas fa-calendar-plus"></i>
                                Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø²
                            </button>
                        </div>
                    </div>

                    <div class="test-card">
                        <h4>Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h4>
                        <div class="bookings-list" id="bookingsList">
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª</p>
                        </div>
                        <button class="btn btn-outline" onclick="testGetBookings()">
                            <i class="fas fa-list"></i>
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </button>
                    </div>
                </div>
            </div>

            <!-- Storage Tests -->
            <div class="test-category">
                <h3>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†</h3>
                <div class="test-grid">
                    <div class="test-card">
                        <h4>Ø±ÙØ¹ ØµÙˆØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h4>
                        <div class="test-form">
                            <input type="file" id="testImage" accept="image/*">
                            <input type="text" id="photoCarId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
                            <button class="btn btn-primary" onclick="testUploadPhoto()">
                                <i class="fas fa-upload"></i>
                                Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
                            </button>
                        </div>
                    </div>

                    <div class="test-card">
                        <h4>Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</h4>
                        <div class="photos-list" id="photosList">
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±</p>
                        </div>
                        <button class="btn btn-outline" onclick="testGetPhotos()">
                            <i class="fas fa-images"></i>
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </button>
                    </div>
                </div>
            </div>

            <!-- Real-time Tests -->
            <div class="test-category">
                <h3>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</h3>
                <div class="test-grid">
                    <div class="test-card">
                        <h4>Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h4>
                        <div class="realtime-status" id="carsRealtimeStatus">
                            <span class="status-indicator inactive"></span>
                            <span>ØºÙŠØ± Ù†Ø´Ø·</span>
                        </div>
                        <button class="btn btn-success" onclick="testCarsRealtime()">
                            <i class="fas fa-play"></i>
                            Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹
                        </button>
                        <button class="btn btn-danger" onclick="stopCarsRealtime()">
                            <i class="fas fa-stop"></i>
                            Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹
                        </button>
                    </div>

                    <div class="test-card">
                        <h4>Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h4>
                        <div class="realtime-status" id="bookingsRealtimeStatus">
                            <span class="status-indicator inactive"></span>
                            <span>ØºÙŠØ± Ù†Ø´Ø·</span>
                        </div>
                        <button class="btn btn-success" onclick="testBookingsRealtime()">
                            <i class="fas fa-play"></i>
                            Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹
                        </button>
                        <button class="btn btn-danger" onclick="stopBookingsRealtime()">
                            <i class="fas fa-stop"></i>
                            Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹
                        </button>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="test-category">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                <div class="test-grid">
                    <div class="test-card">
                        <h4>Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h4>
                        <div class="delete-options">
                            <label>
                                <input type="checkbox" id="deleteUsers"> Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠÙŠÙ†
                            </label>
                            <label>
                                <input type="checkbox" id="deleteCars"> Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                            </label>
                            <label>
                                <input type="checkbox" id="deleteBookings"> Ø­Ø°Ù Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                            </label>
                            <label>
                                <input type="checkbox" id="deletePhotos"> Ø­Ø°Ù Ø§Ù„ØµÙˆØ± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                            </label>
                        </div>
                        <button class="btn btn-danger" onclick="testCleanupData()">
                            <i class="fas fa-trash"></i>
                            Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                        </button>
                    </div>

                    <div class="test-card">
                        <h4>ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                        <button class="btn btn-outline" onclick="testExportData()">
                            <i class="fas fa-download"></i>
                            ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results Display -->
            <div class="results-section">
                <h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h3>
                <div id="testResults" class="test-results">
                    <p>Ù„Ù… ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ø£ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¹Ø¯</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
    
    <!-- Firebase Service -->
    <script src="firebase-service.js"></script>
    
    <script>
        let carsListener = null;
        let bookingsListener = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkFirebaseStatus();
            setupTestData();
        });

        // Check Firebase status
        async function checkFirebaseStatus() {
            try {
                // Check Firebase initialization
                if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                    updateStatus('firebaseStatus', 'Ù…ØªØµÙ„', 'success');
                } else {
                    updateStatus('firebaseStatus', 'ØºÙŠØ± Ù…ØªØµÙ„', 'error');
                    return;
                }

                // Check Authentication
                try {
                    await firebase.auth().signInAnonymously();
                    updateStatus('authStatus', 'Ù…ØªØµÙ„', 'success');
                    await firebase.auth().signOut();
                } catch (error) {
                    updateStatus('authStatus', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©', 'error');
                }

                // Check Database
                try {
                    const testRef = firebase.database().ref('test');
                    await testRef.set({ timestamp: Date.now() });
                    await testRef.remove();
                    updateStatus('databaseStatus', 'Ù…ØªØµÙ„', 'success');
                } catch (error) {
                    updateStatus('databaseStatus', 'Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                }

                // Check Storage
                try {
                    const testRef = firebase.storage().ref('test.txt');
                    const testBlob = new Blob(['test'], { type: 'text/plain' });
                    await testRef.put(testBlob);
                    await testRef.delete();
                    updateStatus('storageStatus', 'Ù…ØªØµÙ„', 'success');
                } catch (error) {
                    updateStatus('storageStatus', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†', 'error');
                }

            } catch (error) {
                console.error('Error checking Firebase status:', error);
                updateStatus('firebaseStatus', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
            }
        }

        // Update status display
        function updateStatus(elementId, value, type) {
            const element = document.getElementById(elementId);
            const statusValue = element.querySelector('.status-value');
            statusValue.textContent = value;
            statusValue.className = `status-value ${type}`;
        }

        // Setup test data
        function setupTestData() {
            // Set default dates
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const dayAfter = new Date(today);
            dayAfter.setDate(dayAfter.getDate() + 2);

            document.getElementById('startDate').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('endDate').value = dayAfter.toISOString().split('T')[0];
        }

        // Test create user
        async function testCreateUser() {
            try {
                const email = document.getElementById('testEmail').value;
                const password = document.getElementById('testPassword').value;
                const userType = document.getElementById('testUserType').value;

                const userData = {
                    full_name: 'Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ',
                    email: email,
                    phone: '+966501234567',
                    city: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                    user_type: userType,
                    password: password
                };

                const result = await firebaseService.registerUser(userData);
                addTestResult('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­: ' + result.user.uid, 'success');
                
                // Update login form
                document.getElementById('loginEmail').value = email;
                document.getElementById('loginPassword').value = password;

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ' + error.message, 'error');
            }
        }

        // Test login
        async function testLogin() {
            try {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                const result = await firebaseService.loginUser(email, password);
                addTestResult('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­: ' + result.user.uid, 'success');
                
                // Update current user info
                testGetCurrentUser();

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, 'error');
            }
        }

        // Test get current user
        async function testGetCurrentUser() {
            try {
                const user = firebaseService.getCurrentUser();
                const profile = await firebaseService.getCurrentUserProfile();
                
                const userInfo = document.getElementById('currentUserInfo');
                
                if (user && profile) {
                    userInfo.innerHTML = `
                        <div class="user-details">
                            <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${profile.full_name}</p>
                            <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${profile.email}</p>
                            <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${profile.user_type === 'renter' ? 'Ù…Ø³ØªØ£Ø¬Ø±' : 'ØµØ§Ø­Ø¨ Ø³ÙŠØ§Ø±Ø©'}</p>
                            <p><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${profile.city}</p>
                        </div>
                    `;
                } else {
                    userInfo.innerHTML = '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>';
                }

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ' + error.message, 'error');
            }
        }

        // Test logout
        async function testLogout() {
            try {
                await firebaseService.logoutUser();
                addTestResult('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                // Clear user info
                document.getElementById('currentUserInfo').innerHTML = '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>';

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: ' + error.message, 'error');
            }
        }

        // Test create car
        async function testCreateCar() {
            try {
                const carData = {
                    brand: document.getElementById('carBrand').value,
                    model: document.getElementById('carModel').value,
                    year: parseInt(document.getElementById('carYear').value),
                    price_per_day: parseInt(document.getElementById('carPrice').value),
                    location: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                    description: document.getElementById('carDescription').value
                };

                const car = await firebaseService.createCar(carData);
                addTestResult('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­: ' + car.id, 'success');
                
                // Update booking form
                document.getElementById('bookingCarId').value = car.id;

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ' + error.message, 'error');
            }
        }

        // Test get cars
        async function testGetCars() {
            try {
                const cars = await firebaseService.getAllCars();
                const carsList = document.getElementById('carsList');
                
                if (cars.length > 0) {
                    carsList.innerHTML = cars.map(car => `
                        <div class="car-item">
                            <strong>${car.brand} ${car.model}</strong>
                            <small>Ø§Ù„Ø³Ø¹Ø±: ${car.price_per_day} Ø±ÙŠØ§Ù„/ÙŠÙˆÙ…</small>
                            <small>Ø§Ù„Ø­Ø§Ù„Ø©: ${car.is_available ? 'Ù…ØªØ§Ø­Ø©' : 'ØºÙŠØ± Ù…ØªØ§Ø­Ø©'}</small>
                        </div>
                    `).join('');
                } else {
                    carsList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª</p>';
                }

                addTestResult(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${cars.length} Ø³ÙŠØ§Ø±Ø©`, 'success');

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª: ' + error.message, 'error');
            }
        }

        // Test create booking
        async function testCreateBooking() {
            try {
                const bookingData = {
                    car_id: document.getElementById('bookingCarId').value,
                    owner_id: 'test-owner-id',
                    start_date: document.getElementById('startDate').value,
                    end_date: document.getElementById('endDate').value,
                    total_price: parseInt(document.getElementById('totalPrice').value)
                };

                const booking = await firebaseService.createBooking(bookingData);
                addTestResult('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­: ' + booking.id, 'success');

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø²: ' + error.message, 'error');
            }
        }

        // Test get bookings
        async function testGetBookings() {
            try {
                const bookings = await firebaseService.getBookingsByUser('renter');
                const bookingsList = document.getElementById('bookingsList');
                
                if (bookings.length > 0) {
                    bookingsList.innerHTML = bookings.map(booking => `
                        <div class="booking-item">
                            <strong>Ø­Ø¬Ø² #${booking.id}</strong>
                            <small>Ù…Ù†: ${booking.start_date}</small>
                            <small>Ø¥Ù„Ù‰: ${booking.end_date}</small>
                            <small>Ø§Ù„Ø³Ø¹Ø±: ${booking.total_price} Ø±ÙŠØ§Ù„</small>
                            <small>Ø§Ù„Ø­Ø§Ù„Ø©: ${booking.status}</small>
                        </div>
                    `).join('');
                } else {
                    bookingsList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª</p>';
                }

                addTestResult(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${bookings.length} Ø­Ø¬Ø²`, 'success');

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª: ' + error.message, 'error');
            }
        }

        // Test upload photo
        async function testUploadPhoto() {
            try {
                const fileInput = document.getElementById('testImage');
                const carId = document.getElementById('photoCarId').value;
                
                if (!fileInput.files[0]) {
                    addTestResult('âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø©', 'error');
                    return;
                }

                if (!carId) {
                    addTestResult('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'error');
                    return;
                }

                const photoData = await firebaseService.uploadCarPhoto(carId, fileInput.files[0]);
                addTestResult('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­: ' + photoData.url, 'success');

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: ' + error.message, 'error');
            }
        }

        // Test get photos
        async function testGetPhotos() {
            try {
                const carId = document.getElementById('photoCarId').value;
                
                if (!carId) {
                    addTestResult('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'error');
                    return;
                }

                const photos = await firebaseService.getCarPhotos(carId);
                const photosList = document.getElementById('photosList');
                
                if (photos.length > 0) {
                    photosList.innerHTML = photos.map(photo => `
                        <div class="photo-item">
                            <img src="${photo.url}" alt="ØµÙˆØ±Ø© Ø³ÙŠØ§Ø±Ø©" style="width: 100px; height: 100px; object-fit: cover;">
                            <small>${photo.filename}</small>
                        </div>
                    `).join('');
                } else {
                    photosList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±</p>';
                }

                addTestResult(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${photos.length} ØµÙˆØ±Ø©`, 'success');

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±: ' + error.message, 'error');
            }
        }

        // Test cars realtime
        function testCarsRealtime() {
            try {
                const statusElement = document.getElementById('carsRealtimeStatus');
                statusElement.innerHTML = '<span class="status-indicator active"></span><span>Ù†Ø´Ø·</span>';
                
                carsListener = firebaseService.onCarsChange((cars) => {
                    addTestResult(`ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø±: ${cars.length} Ø³ÙŠØ§Ø±Ø©`, 'info');
                });

                addTestResult('âœ… ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', 'success');

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹: ' + error.message, 'error');
            }
        }

        // Stop cars realtime
        function stopCarsRealtime() {
            if (carsListener) {
                firebaseService.off('cars');
                carsListener = null;
                
                const statusElement = document.getElementById('carsRealtimeStatus');
                statusElement.innerHTML = '<span class="status-indicator inactive"></span><span>ØºÙŠØ± Ù†Ø´Ø·</span>';
                
                addTestResult('â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', 'info');
            }
        }

        // Test bookings realtime
        function testBookingsRealtime() {
            try {
                const statusElement = document.getElementById('bookingsRealtimeStatus');
                statusElement.innerHTML = '<span class="status-indicator active"></span><span>Ù†Ø´Ø·</span>';
                
                const currentUser = firebaseService.getCurrentUser();
                if (currentUser) {
                    bookingsListener = firebaseService.onBookingsChange(currentUser.uid, 'renter', (bookings) => {
                        addTestResult(`ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø±: ${bookings.length} Ø­Ø¬Ø²`, 'info');
                    });
                }

                addTestResult('âœ… ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª', 'success');

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹: ' + error.message, 'error');
            }
        }

        // Stop bookings realtime
        function stopBookingsRealtime() {
            if (bookingsListener) {
                firebaseService.off('bookings');
                bookingsListener = null;
                
                const statusElement = document.getElementById('bookingsRealtimeStatus');
                statusElement.innerHTML = '<span class="status-indicator inactive"></span><span>ØºÙŠØ± Ù†Ø´Ø·</span>';
                
                addTestResult('â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª', 'info');
            }
        }

        // Test cleanup data
        async function testCleanupData() {
            try {
                const deleteUsers = document.getElementById('deleteUsers').checked;
                const deleteCars = document.getElementById('deleteCars').checked;
                const deleteBookings = document.getElementById('deleteBookings').checked;
                const deletePhotos = document.getElementById('deletePhotos').checked;

                if (!deleteUsers && !deleteCars && !deleteBookings && !deletePhotos) {
                    addTestResult('âŒ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡Ø§', 'error');
                    return;
                }

                // This is a simplified cleanup - in a real app, you'd want more sophisticated cleanup
                addTestResult('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©', 'success');

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
            }
        }

        // Test export data
        async function testExportData() {
            try {
                const data = {
                    timestamp: new Date().toISOString(),
                    cars: await firebaseService.getAllCars(),
                    users: [], // Would need to implement getAllUsers
                    bookings: [] // Would need to implement getAllBookings
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `firebase_export_${new Date().toISOString().split('T')[0]}.json`;
                link.click();

                addTestResult('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');

            } catch (error) {
                addTestResult('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
            }
        }

        // Add test result
        function addTestResult(message, type) {
            const resultsContainer = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            
            const resultElement = document.createElement('div');
            resultElement.className = `test-result ${type}`;
            resultElement.innerHTML = `
                <span class="timestamp">${timestamp}</span>
                <span class="message">${message}</span>
            `;
            
            resultsContainer.appendChild(resultElement);
            resultsContainer.scrollTop = resultsContainer.scrollHeight;
        }
    </script>

    <style>
        .test-section {
            padding: 2rem 0;
        }

        .test-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .test-header h1 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .test-header p {
            color: #7f8c8d;
        }

        .status-section {
            margin-bottom: 2rem;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .status-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .status-card i {
            font-size: 1.5rem;
            color: #3498db;
        }

        .status-content {
            flex: 1;
        }

        .status-label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
        }

        .status-value {
            display: block;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .status-value.success {
            color: #27ae60;
        }

        .status-value.error {
            color: #e74c3c;
        }

        .test-category {
            margin-bottom: 2rem;
        }

        .test-category h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #ecf0f1;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .test-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .test-card h4 {
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        .test-form {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .test-form input,
        .test-form select,
        .test-form textarea {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
        }

        .test-form textarea {
            resize: vertical;
            min-height: 80px;
        }

        .user-info {
            margin-bottom: 1rem;
        }

        .user-details p {
            margin: 0.5rem 0;
            color: #2c3e50;
        }

        .cars-list,
        .bookings-list,
        .photos-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .car-item,
        .booking-item {
            background: #f8f9fa;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            border-left: 3px solid #3498db;
        }

        .car-item strong,
        .booking-item strong {
            display: block;
            color: #2c3e50;
            margin-bottom: 0.25rem;
        }

        .car-item small,
        .booking-item small {
            display: block;
            color: #7f8c8d;
            margin-bottom: 0.25rem;
        }

        .photo-item {
            display: inline-block;
            margin: 0.5rem;
            text-align: center;
        }

        .photo-item img {
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .realtime-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-indicator.active {
            background: #27ae60;
            animation: pulse 2s infinite;
        }

        .status-indicator.inactive {
            background: #95a5a6;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .delete-options {
            margin-bottom: 1rem;
        }

        .delete-options label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .test-results {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
        }

        .test-result {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .test-result:last-child {
            border-bottom: none;
        }

        .test-result .timestamp {
            font-size: 0.8rem;
            color: #7f8c8d;
            min-width: 80px;
        }

        .test-result .message {
            flex: 1;
        }

        .test-result.success .message {
            color: #27ae60;
        }

        .test-result.error .message {
            color: #e74c3c;
        }

        .test-result.info .message {
            color: #3498db;
        }

        .btn {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-outline {
            background: transparent;
            color: #3498db;
            border: 1px solid #3498db;
        }

        .btn-outline:hover {
            background: #3498db;
            color: white;
        }
    </style>
</body>
</html>

