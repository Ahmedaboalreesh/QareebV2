<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹ - Ù…Ù†ØµØ© ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <i class="fas fa-car"></i>
                        <span>Ù…Ù†ØµØ© ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</span>
                    </a>
                </div>
                <nav class="nav">
                    <a href="index.html">
                        <i class="fas fa-home"></i>
                        Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>
                    <i class="fas fa-credit-card"></i>
                    Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹
                </h1>
                <p>ØµÙØ­Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
            </div>

            <!-- Test Booking Creation -->
            <div class="test-card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-plus"></i>
                        Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² ØªØ¬Ø±ÙŠØ¨ÙŠ
                    </h2>
                </div>
                
                <div class="test-content">
                    <div class="form-group">
                        <label for="testCarName">Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
                        <input type="text" id="testCarName" value="ØªÙˆÙŠÙˆØªØ§ ÙƒØ§Ù…Ø±ÙŠ 2023" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="testStartDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                            <input type="date" id="testStartDate" value="2024-01-15">
                        </div>
                        <div class="form-group">
                            <label for="testEndDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                            <input type="date" id="testEndDate" value="2024-01-18">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="testDailyRate">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ø±ÙŠØ§Ù„)</label>
                        <input type="number" id="testDailyRate" value="150" min="50" max="1000">
                    </div>
                    
                    <div class="test-actions">
                        <button class="btn btn-primary" onclick="createTestBooking()">
                            <i class="fas fa-plus"></i>
                            Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² ØªØ¬Ø±ÙŠØ¨ÙŠ
                        </button>
                        
                        <button class="btn btn-secondary" onclick="clearTestData()">
                            <i class="fas fa-trash"></i>
                            Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                        </button>
                    </div>
                </div>
            </div>

            <!-- Test Bookings List -->
            <div class="test-card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-list"></i>
                        Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                    </h2>
                </div>
                
                <div class="test-content">
                    <div id="bookingsList">
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</p>
                    </div>
                </div>
            </div>

            <!-- Payment Methods Test -->
            <div class="test-card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-cogs"></i>
                        Ø§Ø®ØªØ¨Ø§Ø± Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
                    </h2>
                </div>
                
                <div class="test-content">
                    <div class="payment-test-grid">
                        <div class="payment-test-item">
                            <h3>Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹</h3>
                            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</p>
                            <button class="btn btn-outline" onclick="testCashPayment()">
                                <i class="fas fa-money-bill-wave"></i>
                                Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ
                            </button>
                        </div>
                        
                        <div class="payment-test-item">
                            <h3>Ù…Ø¯Ù‰ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h3>
                            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¯Ù‰</p>
                            <button class="btn btn-outline" onclick="testSTCPay()">
                                <i class="fas fa-mobile-alt"></i>
                                Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¯Ù‰
                            </button>
                        </div>
                        
                        <div class="payment-test-item">
                            <h3>Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©</h3>
                            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©</p>
                            <button class="btn btn-outline" onclick="testCreditCard()">
                                <i class="fas fa-credit-card"></i>
                                Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                            </button>
                        </div>
                        
                        <div class="payment-test-item">
                            <h3>Apple Pay</h3>
                            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Apple Pay</p>
                            <button class="btn btn-outline" onclick="testApplePay()">
                                <i class="fab fa-apple-pay"></i>
                                Ø§Ø®ØªØ¨Ø§Ø± Apple Pay
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Records -->
            <div class="test-card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-history"></i>
                        Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
                    </h2>
                </div>
                
                <div class="test-content">
                    <div id="paymentsList">
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø©</p>
                    </div>
                </div>
            </div>

            <!-- Console Output -->
            <div class="test-card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-terminal"></i>
                        Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    </h2>
                </div>
                
                <div class="console-output" id="testConsole">
                    <p>Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Global variables
        let testLog = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” Initializing payment test page...');
            addLog('ğŸ” Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹...');
            
            // Load test data
            loadTestData();
            
            console.log('âœ… Payment test page initialized');
            addLog('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙØ¹');
        });

        // Load test data
        function loadTestData() {
            try {
                // Load bookings
                loadBookingsList();
                
                // Load payments
                loadPaymentsList();
                
                addLog('ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
                
            } catch (error) {
                console.error('âŒ Error loading test data:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©: ' + error.message);
            }
        }

        // Load bookings list
        function loadBookingsList() {
            try {
                const bookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                const bookingsList = document.getElementById('bookingsList');
                
                if (bookings.length === 0) {
                    bookingsList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</p>';
                    return;
                }
                
                const bookingsHTML = bookings.map(booking => `
                    <div class="booking-item">
                        <div class="booking-info">
                            <strong>${booking.car_name || 'Ø³ÙŠØ§Ø±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©'}</strong>
                            <span>${booking.start_date} - ${booking.end_date}</span>
                            <span>${booking.total_amount || 450} Ø±ÙŠØ§Ù„</span>
                        </div>
                        <div class="booking-actions">
                            <button class="btn btn-sm btn-primary" onclick="goToPayment('${booking.id}')">
                                <i class="fas fa-credit-card"></i>
                                Ø§Ù„Ø¯ÙØ¹
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteBooking('${booking.id}')">
                                <i class="fas fa-trash"></i>
                                Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                `).join('');
                
                bookingsList.innerHTML = bookingsHTML;
                
            } catch (error) {
                console.error('âŒ Error loading bookings list:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª: ' + error.message);
            }
        }

        // Load payments list
        function loadPaymentsList() {
            try {
                const payments = JSON.parse(localStorage.getItem('mockPayments') || '[]');
                const paymentsList = document.getElementById('paymentsList');
                
                if (payments.length === 0) {
                    paymentsList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø©</p>';
                    return;
                }
                
                const paymentsHTML = payments.map(payment => `
                    <div class="payment-item">
                        <div class="payment-info">
                            <strong>${getPaymentMethodName(payment.method)}</strong>
                            <span>${payment.amount}</span>
                            <span>${new Date(payment.created_at).toLocaleDateString('ar-SA')}</span>
                        </div>
                        <div class="payment-status ${payment.status}">
                            ${getStatusText(payment.status)}
                        </div>
                    </div>
                `).join('');
                
                paymentsList.innerHTML = paymentsHTML;
                
            } catch (error) {
                console.error('âŒ Error loading payments list:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª: ' + error.message);
            }
        }

        // Get payment method name
        function getPaymentMethodName(method) {
            const methods = {
                'cash': 'Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹',
                'stcpay': 'Ù…Ø¯Ù‰ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©',
                'credit': 'Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©',
                'applepay': 'Apple Pay'
            };
            return methods[method] || method;
        }

        // Get status text
        function getStatusText(status) {
            const statuses = {
                'completed': 'Ù…ÙƒØªÙ…Ù„',
                'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
                'failed': 'ÙØ´Ù„'
            };
            return statuses[status] || status;
        }

        // Create test booking
        function createTestBooking() {
            try {
                const carName = document.getElementById('testCarName').value;
                const startDate = document.getElementById('testStartDate').value;
                const endDate = document.getElementById('testEndDate').value;
                const dailyRate = parseInt(document.getElementById('testDailyRate').value);
                
                if (!carName || !startDate || !endDate || !dailyRate) {
                    addLog('âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                    return;
                }
                
                // Calculate total
                const start = new Date(startDate);
                const end = new Date(endDate);
                const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
                const total = days * dailyRate;
                
                const booking = {
                    id: 'booking-' + Date.now(),
                    car_name: carName,
                    start_date: startDate,
                    end_date: endDate,
                    daily_rate: dailyRate,
                    total_amount: total,
                    status: 'pending',
                    created_at: new Date().toISOString(),
                    user_id: 'test-user'
                };
                
                // Save to localStorage
                const bookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                bookings.push(booking);
                localStorage.setItem('mockBookings', JSON.stringify(bookings));
                
                addLog('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² ØªØ¬Ø±ÙŠØ¨ÙŠ: ' + carName);
                
                // Reload lists
                loadBookingsList();
                
            } catch (error) {
                console.error('âŒ Error creating test booking:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ: ' + error.message);
            }
        }

        // Clear test data
        function clearTestData() {
            try {
                localStorage.removeItem('mockBookings');
                localStorage.removeItem('mockPayments');
                
                addLog('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
                
                // Reload lists
                loadBookingsList();
                loadPaymentsList();
                
            } catch (error) {
                console.error('âŒ Error clearing test data:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©: ' + error.message);
            }
        }

        // Go to payment page
        function goToPayment(bookingId) {
            try {
                addLog('ğŸ”” Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ø­Ø¬Ø²: ' + bookingId);
                window.open(`payment.html?booking_id=${bookingId}`, '_blank');
                
            } catch (error) {
                console.error('âŒ Error going to payment page:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹: ' + error.message);
            }
        }

        // Delete booking
        function deleteBooking(bookingId) {
            try {
                const bookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                const filteredBookings = bookings.filter(b => b.id !== bookingId);
                localStorage.setItem('mockBookings', JSON.stringify(filteredBookings));
                
                addLog('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²: ' + bookingId);
                
                // Reload list
                loadBookingsList();
                
            } catch (error) {
                console.error('âŒ Error deleting booking:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²: ' + error.message);
            }
        }

        // Test cash payment
        function testCashPayment() {
            try {
                addLog('ğŸ’µ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ...');
                
                // Create test payment record
                const payment = {
                    id: 'payment-' + Date.now(),
                    booking_id: 'test-booking',
                    method: 'cash',
                    amount: '450 Ø±ÙŠØ§Ù„',
                    status: 'completed',
                    created_at: new Date().toISOString(),
                    user_id: 'test-user'
                };
                
                // Save to localStorage
                const payments = JSON.parse(localStorage.getItem('mockPayments') || '[]');
                payments.push(payment);
                localStorage.setItem('mockPayments', JSON.stringify(payments));
                
                addLog('âœ… ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
                
                // Reload payments list
                loadPaymentsList();
                
            } catch (error) {
                console.error('âŒ Error testing cash payment:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ: ' + error.message);
            }
        }

        // Test STC Pay
        function testSTCPay() {
            try {
                addLog('ğŸ“± Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¯Ù‰ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©...');
                
                // Simulate STC Pay processing
                setTimeout(() => {
                    const payment = {
                        id: 'payment-' + Date.now(),
                        booking_id: 'test-booking',
                        method: 'stcpay',
                        amount: '450 Ø±ÙŠØ§Ù„',
                        status: 'completed',
                        created_at: new Date().toISOString(),
                        user_id: 'test-user'
                    };
                    
                    // Save to localStorage
                    const payments = JSON.parse(localStorage.getItem('mockPayments') || '[]');
                    payments.push(payment);
                    localStorage.setItem('mockPayments', JSON.stringify(payments));
                    
                    addLog('âœ… ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¯Ù‰ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                    
                    // Reload payments list
                    loadPaymentsList();
                    
                }, 2000);
                
            } catch (error) {
                console.error('âŒ Error testing STC Pay:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¯Ù‰ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©: ' + error.message);
            }
        }

        // Test credit card
        function testCreditCard() {
            try {
                addLog('ğŸ’³ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©...');
                
                // Simulate credit card processing
                setTimeout(() => {
                    const payment = {
                        id: 'payment-' + Date.now(),
                        booking_id: 'test-booking',
                        method: 'credit',
                        amount: '450 Ø±ÙŠØ§Ù„',
                        status: 'completed',
                        created_at: new Date().toISOString(),
                        user_id: 'test-user'
                    };
                    
                    // Save to localStorage
                    const payments = JSON.parse(localStorage.getItem('mockPayments') || '[]');
                    payments.push(payment);
                    localStorage.setItem('mockPayments', JSON.stringify(payments));
                    
                    addLog('âœ… ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                    
                    // Reload payments list
                    loadPaymentsList();
                    
                }, 3000);
                
            } catch (error) {
                console.error('âŒ Error testing credit card:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©: ' + error.message);
            }
        }

        // Test Apple Pay
        function testApplePay() {
            try {
                addLog('ğŸ Ø§Ø®ØªØ¨Ø§Ø± Apple Pay...');
                
                // Check if Apple Pay is available
                if (!window.ApplePaySession || !ApplePaySession.canMakePayments()) {
                    addLog('âš ï¸ Apple Pay ØºÙŠØ± Ù…ØªØ§Ø­ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²');
                    return;
                }
                
                // Simulate Apple Pay processing
                setTimeout(() => {
                    const payment = {
                        id: 'payment-' + Date.now(),
                        booking_id: 'test-booking',
                        method: 'applepay',
                        amount: '450 Ø±ÙŠØ§Ù„',
                        status: 'completed',
                        created_at: new Date().toISOString(),
                        user_id: 'test-user'
                    };
                    
                    // Save to localStorage
                    const payments = JSON.parse(localStorage.getItem('mockPayments') || '[]');
                    payments.push(payment);
                    localStorage.setItem('mockPayments', JSON.stringify(payments));
                    
                    addLog('âœ… ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Apple Pay Ø¨Ù†Ø¬Ø§Ø­');
                    
                    // Reload payments list
                    loadPaymentsList();
                    
                }, 1500);
                
            } catch (error) {
                console.error('âŒ Error testing Apple Pay:', error);
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Apple Pay: ' + error.message);
            }
        }

        // Add log message
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const logEntry = `[${timestamp}] ${message}`;
            
            testLog.push(logEntry);
            console.log(logEntry);
            
            // Update console output
            const testConsole = document.getElementById('testConsole');
            testConsole.innerHTML = testLog.map(log => `<div class="log-entry">${log}</div>`).join('');
            
            // Scroll to bottom
            testConsole.scrollTop = testConsole.scrollHeight;
        }
    </script>

    <style>
        .test-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .card-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
        }

        .card-header h2 {
            margin: 0;
            font-size: 1.2rem;
            color: #495057;
        }

        .test-content {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .test-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .payment-test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .payment-test-item {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }

        .payment-test-item h3 {
            margin: 0 0 0.5rem 0;
            color: #374151;
        }

        .payment-test-item p {
            margin: 0 0 1rem 0;
            color: #6b7280;
        }

        .booking-item,
        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .booking-info,
        .payment-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .booking-actions {
            display: flex;
            gap: 0.5rem;
        }

        .payment-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .payment-status.completed {
            background: #d1fae5;
            color: #065f46;
        }

        .payment-status.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .payment-status.failed {
            background: #fee2e2;
            color: #991b1b;
        }

        .console-output {
            background: #1e1e1e;
            color: #ffffff;
            padding: 1rem;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .log-entry:last-child {
            margin-bottom: 0;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .test-actions {
                flex-direction: column;
            }
            
            .payment-test-grid {
                grid-template-columns: 1fr;
            }
            
            .booking-item,
            .payment-item {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }
    </style>
</body>
</html>
