<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุฅุดุนุงุฑุงุช ูุงูู ุงูุณูุงุฑุฉ - ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <i class="fas fa-car"></i>
                        <span>ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช</span>
                    </a>
                </div>
                <nav class="nav">
                    <a href="notifications.html">
                        <i class="fas fa-bell"></i>
                        ุงูุฅุดุนุงุฑุงุช
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                    </a>
                    <a href="index.html">
                        <i class="fas fa-home"></i>
                        ุงูุฑุฆูุณูุฉ
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>
                    <i class="fas fa-user-tie"></i>
                    ุงุฎุชุจุงุฑ ุฅุดุนุงุฑุงุช ูุงูู ุงูุณูุงุฑุฉ
                </h1>
                <p>ุตูุญุฉ ูุงุฎุชุจุงุฑ ุฅุดุนุงุฑุงุช ูุงูู ุงูุณูุงุฑุฉ ุนูุฏ ุฑูุน ุงูุตูุฑ</p>
            </div>

            <!-- Car Owner Setup -->
            <div class="setup-card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-cogs"></i>
                        ุฅุนุฏุงุฏ ูุงูู ุงูุณูุงุฑุฉ
                    </h2>
                </div>
                
                <div class="setup-content">
                    <div class="user-info">
                        <h3>ูุนูููุงุช ูุงูู ุงูุณูุงุฑุฉ ุงูุญุงูู:</h3>
                        <div id="currentUserInfo">
                            <p>ุฌุงุฑู ุชุญููู ุงููุนูููุงุช...</p>
                        </div>
                    </div>
                    
                    <div class="setup-actions">
                        <button class="btn btn-primary" onclick="setupCarOwner()">
                            <i class="fas fa-user-plus"></i>
                            ุฅุนุฏุงุฏ ูุงูู ุงูุณูุงุฑุฉ
                        </button>
                        <button class="btn btn-success" onclick="switchToCarOwner()">
                            <i class="fas fa-exchange-alt"></i>
                            ุงูุชุจุฏูู ููุงูู ุงูุณูุงุฑุฉ
                        </button>
                        <button class="btn btn-info" onclick="viewNotifications()">
                            <i class="fas fa-bell"></i>
                            ุนุฑุถ ุงูุฅุดุนุงุฑุงุช
                        </button>
                    </div>
                </div>
            </div>

            <!-- Test Scenarios -->
            <div class="test-scenarios-card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-flask"></i>
                        ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ
                    </h2>
                </div>
                
                <div class="scenarios-content">
                    <div class="scenario">
                        <h3>ุงูุณููุงุฑูู ุงูุฃูู: ุฑูุน ุตูุฑ ูู ุงููุณุชุฃุฌุฑ</h3>
                        <p>1. ุงูุชูู ุฅูู ุตูุญุฉ ุฑูุน ุงูุตูุฑ ูุงููุณุชุฃุฌุฑ</p>
                        <p>2. ุงุฑูุน ุตูุฑ ููุญุฌุฒ</p>
                        <p>3. ุนุฏ ุฅูู ูุฐู ุงูุตูุญุฉ ููุงูู ุงูุณูุงุฑุฉ</p>
                        <p>4. ุณุชุฌุฏ ุฅุดุนุงุฑ ุนู ุฑูุน ุงูุตูุฑ</p>
                        <div class="scenario-actions">
                            <a href="upload-booking-photos.html?booking_id=1" class="btn btn-primary">
                                <i class="fas fa-camera"></i>
                                ุฑูุน ุตูุฑ (ูุงููุณุชุฃุฌุฑ)
                            </a>
                        </div>
                    </div>
                    
                    <div class="scenario">
                        <h3>ุงูุณููุงุฑูู ุงูุซุงูู: ุฅูุดุงุก ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ</h3>
                        <p>1. ุฃูุดุฆ ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ ููุงูู ุงูุณูุงุฑุฉ</p>
                        <p>2. ุงุฎุชุจุฑ ุนุฑุถ ุงูุฅุดุนุงุฑุงุช</p>
                        <p>3. ุงุฎุชุจุฑ ูุฑุงุกุฉ ูุญุฐู ุงูุฅุดุนุงุฑุงุช</p>
                        <div class="scenario-actions">
                            <button class="btn btn-success" onclick="createTestNotifications()">
                                <i class="fas fa-plus"></i>
                                ุฅูุดุงุก ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications Display -->
            <div class="notifications-display-card" id="notificationsDisplay" style="display: none;">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-bell"></i>
                        ุฅุดุนุงุฑุงุช ูุงูู ุงูุณูุงุฑุฉ
                    </h2>
                </div>
                
                <div class="notifications-list" id="notificationsList">
                    <!-- Notifications will be displayed here -->
                </div>
            </div>

            <!-- Instructions -->
            <div class="instructions-card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-info-circle"></i>
                        ุชุนูููุงุช ุงูุงุฎุชุจุงุฑ
                    </h2>
                </div>
                
                <div class="instructions-content">
                    <h3>ููููุฉ ุงุฎุชุจุงุฑ ุฅุดุนุงุฑุงุช ูุงูู ุงูุณูุงุฑุฉ:</h3>
                    <ol>
                        <li><strong>ุฅุนุฏุงุฏ ูุงูู ุงูุณูุงุฑุฉ:</strong> ุงููุฑ ุนูู "ุฅุนุฏุงุฏ ูุงูู ุงูุณูุงุฑุฉ" ูุฅูุดุงุก ูุณุชุฎุฏู ุชุฌุฑูุจู</li>
                        <li><strong>ุงูุชุจุฏูู ููุงูู ุงูุณูุงุฑุฉ:</strong> ุงููุฑ ุนูู "ุงูุชุจุฏูู ููุงูู ุงูุณูุงุฑุฉ" ูุชุตุจุญ ูุงูู ุงูุณูุงุฑุฉ</li>
                        <li><strong>ุฑูุน ุตูุฑ:</strong> ุงูุชูู ูุตูุญุฉ ุฑูุน ุงูุตูุฑ ูุงููุณุชุฃุฌุฑ ูุงุฑูุน ุตูุฑ</li>
                        <li><strong>ูุญุต ุงูุฅุดุนุงุฑุงุช:</strong> ุนุฏ ููุงูู ุงูุณูุงุฑุฉ ูุงูุญุต ุงูุฅุดุนุงุฑุงุช</li>
                    </ol>
                    
                    <h3>ููุงุญุธุงุช ูููุฉ:</h3>
                    <ul>
                        <li>ูุฌุจ ุฃู ุชููู ูุงูู ุงูุณูุงุฑุฉ ูุฑุคูุฉ ุงูุฅุดุนุงุฑุงุช</li>
                        <li>ุงูุฅุดุนุงุฑุงุช ุชููุดุฃ ุชููุงุฆูุงู ุนูุฏ ุฑูุน ุงูุตูุฑ</li>
                        <li>ููููู ุฅูุดุงุก ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ ููุงุฎุชุจุงุฑ</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Global variables
        let currentUser = null;
        let mockNotifications = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('๐ Initializing car owner test page...');
            
            // Load current user
            loadCurrentUser();
            
            // Load notifications
            loadMockNotifications();
            
            // Update display
            updateUserInfo();
            updateNotificationDisplay();
            
            console.log('โ Car owner test page initialized');
        });

        // Load current user from localStorage
        function loadCurrentUser() {
            try {
                const userData = localStorage.getItem('userData');
                if (userData) {
                    currentUser = JSON.parse(userData);
                    console.log('๐ค Current user loaded:', currentUser);
                } else {
                    console.log('๐ค No user data found');
                }
            } catch (error) {
                console.error('โ Error loading current user:', error);
            }
        }

        // Load mock notifications from localStorage
        function loadMockNotifications() {
            try {
                mockNotifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                console.log('๐ Loaded', mockNotifications.length, 'mock notifications');
            } catch (error) {
                console.error('โ Error loading mock notifications:', error);
                mockNotifications = [];
            }
        }

        // Setup car owner user
        function setupCarOwner() {
            try {
                console.log('๐ค Setting up car owner user...');
                
                const carOwnerData = {
                    id: 'test-owner',
                    full_name: 'ูุงูู ุงูุณูุงุฑุฉ ุงูุชุฌุฑูุจู',
                    email: 'owner@example.com',
                    user_type: 'owner'
                };
                
                // Store in localStorage
                localStorage.setItem('userData', JSON.stringify(carOwnerData));
                localStorage.setItem('userToken', 'owner-token-' + Date.now());
                localStorage.setItem('userType', 'owner');
                
                // Update current user
                currentUser = carOwnerData;
                
                // Update display
                updateUserInfo();
                
                showMessage('ุชู ุฅุนุฏุงุฏ ูุงูู ุงูุณูุงุฑุฉ ุจูุฌุงุญ', 'success');
                console.log('โ Car owner setup completed:', carOwnerData);
                
            } catch (error) {
                console.error('โ Error setting up car owner:', error);
                showMessage('ุญุฏุซ ุฎุทุฃ ูู ุฅุนุฏุงุฏ ูุงูู ุงูุณูุงุฑุฉ', 'error');
            }
        }

        // Switch to car owner
        function switchToCarOwner() {
            try {
                console.log('๐ค Switching to car owner...');
                
                const carOwnerData = {
                    id: 'test-owner',
                    full_name: 'ูุงูู ุงูุณูุงุฑุฉ ุงูุชุฌุฑูุจู',
                    email: 'owner@example.com',
                    user_type: 'owner'
                };
                
                // Store in localStorage
                localStorage.setItem('userData', JSON.stringify(carOwnerData));
                localStorage.setItem('userToken', 'owner-token-' + Date.now());
                localStorage.setItem('userType', 'owner');
                
                // Update current user
                currentUser = carOwnerData;
                
                // Update display
                updateUserInfo();
                updateNotificationDisplay();
                
                showMessage('ุชู ุงูุชุจุฏูู ููุงูู ุงูุณูุงุฑุฉ ุจูุฌุงุญ', 'success');
                console.log('โ Switched to car owner:', carOwnerData);
                
            } catch (error) {
                console.error('โ Error switching to car owner:', error);
                showMessage('ุญุฏุซ ุฎุทุฃ ูู ุงูุชุจุฏูู ููุงูู ุงูุณูุงุฑุฉ', 'error');
            }
        }

        // Update user info display
        function updateUserInfo() {
            const userInfoDiv = document.getElementById('currentUserInfo');
            
            if (currentUser) {
                userInfoDiv.innerHTML = `
                    <div class="user-details">
                        <p><strong>ุงูุงุณู:</strong> ${currentUser.full_name}</p>
                        <p><strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> ${currentUser.email}</p>
                        <p><strong>ููุน ุงููุณุชุฎุฏู:</strong> ${currentUser.user_type === 'owner' ? 'ูุงูู ุงูุณูุงุฑุฉ' : 'ูุณุชุฃุฌุฑ'}</p>
                        <p><strong>ูุนุฑู ุงููุณุชุฎุฏู:</strong> ${currentUser.id}</p>
                    </div>
                `;
            } else {
                userInfoDiv.innerHTML = `
                    <div class="no-user">
                        <p>ูุง ููุฌุฏ ูุณุชุฎุฏู ูุณุฌู ุญุงููุงู</p>
                        <p>ูู ุจุฅุนุฏุงุฏ ูุงูู ุงูุณูุงุฑุฉ ููุงุฎุชุจุงุฑ</p>
                    </div>
                `;
            }
        }

        // Create test notifications
        function createTestNotifications() {
            try {
                console.log('๐ Creating test notifications for car owner...');
                
                if (!currentUser || currentUser.id !== 'test-owner') {
                    showMessage('ูุฌุจ ุฃู ุชููู ูุงูู ุงูุณูุงุฑุฉ ุฃููุงู', 'error');
                    return;
                }
                
                // Create multiple test notifications
                const testNotifications = [
                    {
                        id: 'test-notification-1-' + Date.now(),
                        user_id: 'test-owner',
                        type: 'photo_uploaded',
                        title: 'ุชู ุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ููุญุฌุฒ',
                        description: 'ูุงู ุงููุณุชุฃุฌุฑ ุฃุญูุฏ ูุญูุฏ ุจุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ูุญุฌุฒ ุชูููุชุง ูุงูุฑู 2022',
                        related_id: '1',
                        related_type: 'booking',
                        is_read: false,
                        created_at: new Date().toISOString(),
                        booking_details: {
                            car_name: 'ุชูููุชุง ูุงูุฑู 2022',
                            renter_name: 'ุฃุญูุฏ ูุญูุฏ',
                            booking_id: '1'
                        }
                    },
                    {
                        id: 'test-notification-2-' + Date.now(),
                        user_id: 'test-owner',
                        type: 'photo_uploaded',
                        title: 'ุชู ุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ููุญุฌุฒ',
                        description: 'ูุงู ุงููุณุชุฃุฌุฑ ุณุงุฑุฉ ุฃุญูุฏ ุจุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ูุญุฌุฒ ูููุฏุง ุณูููู 2023',
                        related_id: '2',
                        related_type: 'booking',
                        is_read: false,
                        created_at: new Date(Date.now() - 3600000).toISOString(), // 1 hour ago
                        booking_details: {
                            car_name: 'ูููุฏุง ุณูููู 2023',
                            renter_name: 'ุณุงุฑุฉ ุฃุญูุฏ',
                            booking_id: '2'
                        }
                    }
                ];
                
                // Add to localStorage
                const existingNotifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                existingNotifications.push(...testNotifications);
                localStorage.setItem('mockNotifications', JSON.stringify(existingNotifications));
                
                // Update local state
                mockNotifications = existingNotifications;
                
                // Update display
                updateNotificationDisplay();
                
                showMessage('ุชู ุฅูุดุงุก ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ ุจูุฌุงุญ', 'success');
                console.log('โ Test notifications created:', testNotifications);
                
            } catch (error) {
                console.error('โ Error creating test notifications:', error);
                showMessage('ุญุฏุซ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฅุดุนุงุฑุงุช ุงูุชุฌุฑูุจูุฉ', 'error');
            }
        }

        // View notifications
        function viewNotifications() {
            const display = document.getElementById('notificationsDisplay');
            display.style.display = 'block';
            
            // Update notifications display
            updateNotificationDisplay();
            
            // Scroll to notifications
            display.scrollIntoView({ behavior: 'smooth' });
        }

        // Update notification display
        function updateNotificationDisplay() {
            if (!currentUser || currentUser.id !== 'test-owner') {
                console.log('๐ค Not car owner, filtering notifications...');
                return;
            }
            
            // Filter notifications for current car owner
            const carOwnerNotifications = mockNotifications.filter(n => n.user_id === 'test-owner');
            
            // Update badge
            const unreadCount = carOwnerNotifications.filter(n => !n.is_read).length;
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                if (unreadCount > 0) {
                    badge.textContent = unreadCount;
                    badge.style.display = 'inline';
                } else {
                    badge.style.display = 'none';
                }
            }
            
            // Update notifications list
            const notificationsList = document.getElementById('notificationsList');
            if (carOwnerNotifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell-slash"></i>
                        <h3>ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช</h3>
                        <p>ูู ุจุฑูุน ุตูุฑ ูุงููุณุชุฃุฌุฑ ุฃู ุฃูุดุฆ ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ</p>
                    </div>
                `;
            } else {
                const notificationsHTML = carOwnerNotifications
                    .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                    .map(notification => `
                        <div class="notification-item ${notification.is_read ? '' : 'unread'}" data-id="${notification.id}">
                            <div class="notification-icon">
                                <i class="fas fa-camera"></i>
                            </div>
                            <div class="notification-content">
                                <h4>${notification.title}</h4>
                                <p>${notification.description}</p>
                                <small>${formatTime(notification.created_at)}</small>
                                ${notification.booking_details ? `
                                    <div class="booking-details">
                                        <small><strong>ุงูุณูุงุฑุฉ:</strong> ${notification.booking_details.car_name}</small>
                                        <small><strong>ุงููุณุชุฃุฌุฑ:</strong> ${notification.booking_details.renter_name}</small>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="notification-actions">
                                ${!notification.is_read ? '<span class="unread-indicator"></span>' : ''}
                                <button class="btn btn-sm btn-primary" onclick="markAsRead('${notification.id}')">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteNotification('${notification.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');
                
                notificationsList.innerHTML = notificationsHTML;
            }
            
            console.log(`๐ Displayed ${carOwnerNotifications.length} notifications for car owner`);
        }

        // Format time
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('ar-SA');
        }

        // Mark notification as read
        function markAsRead(notificationId) {
            try {
                const notification = mockNotifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.is_read = true;
                    localStorage.setItem('mockNotifications', JSON.stringify(mockNotifications));
                    updateNotificationDisplay();
                    showMessage('ุชู ุชุญุฏูุซ ุงูุฅุดุนุงุฑ', 'success');
                }
            } catch (error) {
                console.error('โ Error marking notification as read:', error);
                showMessage('ุญุฏุซ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุฅุดุนุงุฑ', 'error');
            }
        }

        // Delete notification
        function deleteNotification(notificationId) {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุฅุดุนุงุฑุ')) {
                try {
                    mockNotifications = mockNotifications.filter(n => n.id !== notificationId);
                    localStorage.setItem('mockNotifications', JSON.stringify(mockNotifications));
                    updateNotificationDisplay();
                    showMessage('ุชู ุญุฐู ุงูุฅุดุนุงุฑ', 'success');
                } catch (error) {
                    console.error('โ Error deleting notification:', error);
                    showMessage('ุญุฏุซ ุฎุทุฃ ูู ุญุฐู ุงูุฅุดุนุงุฑ', 'error');
                }
            }
        }

        // Show message
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                max-width: 400px;
                word-wrap: break-word;
                ${type === 'success' ? 'background-color: #28a745;' : 'background-color: #dc3545;'}
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
