<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช - ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <i class="fas fa-car"></i>
                        <span>ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช</span>
                    </a>
                </div>
                <nav class="nav">
                    <a href="notifications.html">
                        <i class="fas fa-bell"></i>
                        ุงูุฅุดุนุงุฑุงุช
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                    </a>
                    <a href="index.html">
                        <i class="fas fa-home"></i>
                        ุงูุฑุฆูุณูุฉ
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>
                    <i class="fas fa-bell"></i>
                    ุงุฎุชุจุงุฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช
                </h1>
                <p>ุตูุญุฉ ูุงุฎุชุจุงุฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูุชุฌุฑูุจู</p>
            </div>

            <!-- Test Controls -->
            <div class="test-controls-card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-cogs"></i>
                        ุฃุฏูุงุช ุงูุงุฎุชุจุงุฑ
                    </h2>
                </div>
                
                <div class="test-controls">
                    <div class="control-group">
                        <h3>ุฅูุดุงุก ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ</h3>
                        <button class="btn btn-primary" onclick="createTestNotification('photo_uploaded')">
                            <i class="fas fa-camera"></i>
                            ุฅุดุนุงุฑ ุฑูุน ุตูุฑ
                        </button>
                        <button class="btn btn-success" onclick="createTestNotification('booking_approved')">
                            <i class="fas fa-check"></i>
                            ุฅุดุนุงุฑ ููุงููุฉ ุญุฌุฒ
                        </button>
                        <button class="btn btn-warning" onclick="createTestNotification('booking_rejected')">
                            <i class="fas fa-times"></i>
                            ุฅุดุนุงุฑ ุฑูุถ ุญุฌุฒ
                        </button>
                    </div>
                    
                    <div class="control-group">
                        <h3>ุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช</h3>
                        <button class="btn btn-info" onclick="viewNotifications()">
                            <i class="fas fa-eye"></i>
                            ุนุฑุถ ุงูุฅุดุนุงุฑุงุช
                        </button>
                        <button class="btn btn-secondary" onclick="clearAllNotifications()">
                            <i class="fas fa-trash"></i>
                            ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช
                        </button>
                    </div>
                    
                    <div class="control-group">
                        <h3>ูุนูููุงุช ุงููุธุงู</h3>
                        <div class="info-display">
                            <p><strong>ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช:</strong> <span id="notificationCount">0</span></p>
                            <p><strong>ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ:</strong> <span id="unreadCount">0</span></p>
                            <p><strong>ูุถุน ุงูุชุดุบูู:</strong> <span class="status-badge test-mode">ูุถุน ุงูุงุฎุชุจุงุฑ</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications Display -->
            <div class="notifications-display-card" id="notificationsDisplay" style="display: none;">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-bell"></i>
                        ุงูุฅุดุนุงุฑุงุช ุงูุชุฌุฑูุจูุฉ
                    </h2>
                </div>
                
                <div class="notifications-list" id="notificationsList">
                    <!-- Notifications will be displayed here -->
                </div>
            </div>

            <!-- Instructions -->
            <div class="instructions-card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-info-circle"></i>
                        ุชุนูููุงุช ุงูุงุฎุชุจุงุฑ
                    </h2>
                </div>
                
                <div class="instructions-content">
                    <h3>ููููุฉ ุงุฎุชุจุงุฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช:</h3>
                    <ol>
                        <li><strong>ุฅูุดุงุก ุฅุดุนุงุฑุงุช:</strong> ุงููุฑ ุนูู ุงูุฃุฒุฑุงุฑ ูุฅูุดุงุก ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ</li>
                        <li><strong>ุนุฑุถ ุงูุฅุดุนุงุฑุงุช:</strong> ุงููุฑ ุนูู "ุนุฑุถ ุงูุฅุดุนุงุฑุงุช" ูุฑุคูุฉ ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุซุฉ</li>
                        <li><strong>ุงุฎุชุจุงุฑ ุฑูุน ุงูุตูุฑ:</strong> ุงุฐูุจ ุฅูู ุตูุญุฉ ุฑูุน ุงูุตูุฑ ูุฃูุดุฆ ุฅุดุนุงุฑุงุช ุญููููุฉ</li>
                        <li><strong>ูุญุต ุงูุฅุดุนุงุฑุงุช:</strong> ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช ูุฑุคูุฉ ุงูุฅุดุนุงุฑุงุช</li>
                    </ol>
                    
                    <h3>ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงููุชุงุญุฉ:</h3>
                    <ul>
                        <li><strong>ุฑูุน ุตูุฑ:</strong> ุนูุฏ ุฑูุน ุตูุฑ ููุญุฌุฒ</li>
                        <li><strong>ููุงููุฉ ุญุฌุฒ:</strong> ุนูุฏ ููุงููุฉ ูุงูู ุงูุณูุงุฑุฉ ุนูู ุงูุญุฌุฒ</li>
                        <li><strong>ุฑูุถ ุญุฌุฒ:</strong> ุนูุฏ ุฑูุถ ูุงูู ุงูุณูุงุฑุฉ ููุญุฌุฒ</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Global variables
        let mockNotifications = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('๐ Initializing test notifications page...');
            
            // Load existing notifications
            loadMockNotifications();
            
            // Update display
            updateNotificationDisplay();
            
            console.log('โ Test notifications page initialized');
        });

        // Load mock notifications from localStorage
        function loadMockNotifications() {
            try {
                mockNotifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                console.log('๐ Loaded', mockNotifications.length, 'mock notifications');
            } catch (error) {
                console.error('โ Error loading mock notifications:', error);
                mockNotifications = [];
            }
        }

        // Create test notification
        function createTestNotification(type) {
            try {
                console.log('๐ Creating test notification:', type);
                
                const notificationData = {
                    id: 'test-notification-' + Date.now(),
                    user_id: 'test-owner',
                    type: type,
                    title: getNotificationTitle(type),
                    description: getNotificationDescription(type),
                    related_id: 'test-booking-' + Date.now(),
                    related_type: 'booking',
                    is_read: false,
                    created_at: new Date().toISOString()
                };
                
                // Add to localStorage
                mockNotifications.push(notificationData);
                localStorage.setItem('mockNotifications', JSON.stringify(mockNotifications));
                
                // Update display
                updateNotificationDisplay();
                
                // Show success message
                showMessage('ุชู ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฌุฑูุจู ุจูุฌุงุญ', 'success');
                
                console.log('โ Test notification created:', notificationData);
                
            } catch (error) {
                console.error('โ Error creating test notification:', error);
                showMessage('ุญุฏุซ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฅุดุนุงุฑ ุงูุชุฌุฑูุจู', 'error');
            }
        }

        // Get notification title based on type
        function getNotificationTitle(type) {
            const titles = {
                'photo_uploaded': 'ุชู ุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ููุญุฌุฒ',
                'booking_approved': 'ุชูุช ุงูููุงููุฉ ุนูู ุทูุจ ุงูุญุฌุฒ',
                'booking_rejected': 'ุชู ุฑูุถ ุทูุจ ุงูุญุฌุฒ'
            };
            return titles[type] || 'ุฅุดุนุงุฑ ุฌุฏูุฏ';
        }

        // Get notification description based on type
        function getNotificationDescription(type) {
            const descriptions = {
                'photo_uploaded': 'ูุงู ุงููุณุชุฃุฌุฑ ุจุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ูุญุฌุฒ ุงูุณูุงุฑุฉ',
                'booking_approved': 'ุชูุช ุงูููุงููุฉ ุนูู ุทูุจ ุญุฌุฒ ุงูุณูุงุฑุฉ ุจูุฌุงุญ',
                'booking_rejected': 'ุชู ุฑูุถ ุทูุจ ุญุฌุฒ ุงูุณูุงุฑุฉ'
            };
            return descriptions[type] || 'ุฅุดุนุงุฑ ุฌุฏูุฏ ูู ุงููุธุงู';
        }

        // View notifications
        function viewNotifications() {
            const display = document.getElementById('notificationsDisplay');
            display.style.display = 'block';
            
            // Scroll to notifications
            display.scrollIntoView({ behavior: 'smooth' });
        }

        // Clear all notifications
        function clearAllNotifications() {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุชุ')) {
                try {
                    localStorage.removeItem('mockNotifications');
                    mockNotifications = [];
                    updateNotificationDisplay();
                    showMessage('ุชู ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช', 'success');
                    console.log('โ All notifications cleared');
                } catch (error) {
                    console.error('โ Error clearing notifications:', error);
                    showMessage('ุญุฏุซ ุฎุทุฃ ูู ุญุฐู ุงูุฅุดุนุงุฑุงุช', 'error');
                }
            }
        }

        // Update notification display
        function updateNotificationDisplay() {
            // Update counts
            const totalCount = mockNotifications.length;
            const unreadCount = mockNotifications.filter(n => !n.is_read).length;
            
            document.getElementById('notificationCount').textContent = totalCount;
            document.getElementById('unreadCount').textContent = unreadCount;
            
            // Update badge
            const badge = document.getElementById('notificationBadge');
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'inline';
            } else {
                badge.style.display = 'none';
            }
            
            // Update notifications list
            const notificationsList = document.getElementById('notificationsList');
            if (mockNotifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell-slash"></i>
                        <h3>ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช</h3>
                        <p>ูู ุจุฅูุดุงุก ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ ููุงุฎุชุจุงุฑ</p>
                    </div>
                `;
            } else {
                const notificationsHTML = mockNotifications
                    .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                    .map(notification => `
                        <div class="notification-item ${notification.is_read ? '' : 'unread'}" data-id="${notification.id}">
                            <div class="notification-icon">
                                <i class="fas ${getNotificationIcon(notification.type)}"></i>
                            </div>
                            <div class="notification-content">
                                <h4>${notification.title}</h4>
                                <p>${notification.description}</p>
                                <small>${formatTime(notification.created_at)}</small>
                            </div>
                            <div class="notification-actions">
                                ${!notification.is_read ? '<span class="unread-indicator"></span>' : ''}
                                <button class="btn btn-sm btn-primary" onclick="markAsRead('${notification.id}')">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteNotification('${notification.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');
                
                notificationsList.innerHTML = notificationsHTML;
            }
        }

        // Get notification icon based on type
        function getNotificationIcon(type) {
            const icons = {
                'photo_uploaded': 'fa-camera',
                'booking_approved': 'fa-check-circle',
                'booking_rejected': 'fa-times-circle'
            };
            return icons[type] || 'fa-bell';
        }

        // Format time
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('ar-SA');
        }

        // Mark notification as read
        function markAsRead(notificationId) {
            try {
                const notification = mockNotifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.is_read = true;
                    localStorage.setItem('mockNotifications', JSON.stringify(mockNotifications));
                    updateNotificationDisplay();
                    showMessage('ุชู ุชุญุฏูุซ ุงูุฅุดุนุงุฑ', 'success');
                }
            } catch (error) {
                console.error('โ Error marking notification as read:', error);
                showMessage('ุญุฏุซ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุฅุดุนุงุฑ', 'error');
            }
        }

        // Delete notification
        function deleteNotification(notificationId) {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุฅุดุนุงุฑุ')) {
                try {
                    mockNotifications = mockNotifications.filter(n => n.id !== notificationId);
                    localStorage.setItem('mockNotifications', JSON.stringify(mockNotifications));
                    updateNotificationDisplay();
                    showMessage('ุชู ุญุฐู ุงูุฅุดุนุงุฑ', 'success');
                } catch (error) {
                    console.error('โ Error deleting notification:', error);
                    showMessage('ุญุฏุซ ุฎุทุฃ ูู ุญุฐู ุงูุฅุดุนุงุฑ', 'error');
                }
            }
        }

        // Show message
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                max-width: 400px;
                word-wrap: break-word;
                ${type === 'success' ? 'background-color: #28a745;' : 'background-color: #dc3545;'}
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
