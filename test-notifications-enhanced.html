<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช ุงููุญุณู - ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <i class="fas fa-car"></i>
                        <span>ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช</span>
                    </a>
                </div>
                <nav class="nav">
                    <a href="index.html">
                        <i class="fas fa-home"></i>
                        ุงูุฑุฆูุณูุฉ
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>
                    <i class="fas fa-bell"></i>
                    ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช ุงููุญุณู
                </h1>
                <p>ุตูุญุฉ ุดุงููุฉ ูุงุฎุชุจุงุฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช ูุชุตุญูุญ ุงููุดุงูู</p>
            </div>

            <!-- User Management -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-user"></i>
                    ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
                </h3>
                <div class="user-controls">
                    <button class="btn btn-primary" onclick="loginAsRenter()">
                        <i class="fas fa-user"></i>
                        ุชุณุฌูู ุฏุฎูู ููุณุชุฃุฌุฑ
                    </button>
                    <button class="btn btn-primary" onclick="loginAsOwner()">
                        <i class="fas fa-user-tie"></i>
                        ุชุณุฌูู ุฏุฎูู ููุงูู ุณูุงุฑุฉ
                    </button>
                    <button class="btn btn-secondary" onclick="clearUserData()">
                        <i class="fas fa-trash"></i>
                        ูุณุญ ุจูุงูุงุช ุงููุณุชุฎุฏู
                    </button>
                </div>
                <div class="current-user-info" id="currentUserInfo">
                    <p>ูู ูุชู ุชุณุฌูู ุฏุฎูู ุฃู ูุณุชุฎุฏู</p>
                </div>
            </div>

            <!-- Notification Creation -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-plus"></i>
                    ุฅูุดุงุก ุงูุฅุดุนุงุฑุงุช
                </h3>
                <div class="notification-creator">
                    <div class="form-group">
                        <label>ููุน ุงูุฅุดุนุงุฑ:</label>
                        <select id="notificationType">
                            <option value="photo_uploaded">ุฑูุน ุงูุตูุฑ</option>
                            <option value="booking_status_updated">ุชุญุฏูุซ ุงูุญุฌุฒ</option>
                            <option value="review_received">ุงูุชููููุงุช</option>
                            <option value="booking_created">ุญุฌุฒ ุฌุฏูุฏ</option>
                            <option value="payment_received">ุงูุฏูุน</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ุงูุนููุงู:</label>
                        <input type="text" id="notificationTitle" placeholder="ุนููุงู ุงูุฅุดุนุงุฑ">
                    </div>
                    <div class="form-group">
                        <label>ุงููุตู:</label>
                        <textarea id="notificationDescription" placeholder="ูุตู ุงูุฅุดุนุงุฑ"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="createTestNotification()">
                        <i class="fas fa-plus"></i>
                        ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฌุฑูุจู
                    </button>
                </div>
            </div>

            <!-- Simulate Photo Upload -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-camera"></i>
                    ูุญุงูุงุฉ ุฑูุน ุงูุตูุฑ
                </h3>
                <div class="photo-upload-simulator">
                    <div class="form-group">
                        <label>ููุน ุงูุตูุฑุฉ:</label>
                        <select id="photoType">
                            <option value="exterior">ุตูุฑ ุฎุงุฑุฌูุฉ</option>
                            <option value="interior">ุตูุฑ ุฏุงุฎููุฉ</option>
                            <option value="damage">ุตูุฑ ุงูุฃุถุฑุงุฑ</option>
                            <option value="general">ุตูุฑ ุนุงูุฉ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ูุตู ุงูุตูุฑ:</label>
                        <textarea id="photoDescription" placeholder="ูุตู ุงูุตูุฑ ุงููุฑููุนุฉ"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="simulatePhotoUpload()">
                        <i class="fas fa-upload"></i>
                        ูุญุงูุงุฉ ุฑูุน ุงูุตูุฑ
                    </button>
                </div>
            </div>

            <!-- Current Data -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-database"></i>
                    ุงูุจูุงูุงุช ุงูุญุงููุฉ
                </h3>
                <div class="data-display">
                    <div class="data-card">
                        <h4>ุงููุณุชุฎุฏููู</h4>
                        <div id="usersData">ุฌุงุฑู ุงูุชุญููู...</div>
                    </div>
                    <div class="data-card">
                        <h4>ุงูุฅุดุนุงุฑุงุช</h4>
                        <div id="notificationsData">ุฌุงุฑู ุงูุชุญููู...</div>
                    </div>
                    <div class="data-card">
                        <h4>ุงูุญุฌูุฒุงุช</h4>
                        <div id="bookingsData">ุฌุงุฑู ุงูุชุญููู...</div>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="refreshData()">
                    <i class="fas fa-refresh"></i>
                    ุชุญุฏูุซ ุงูุจูุงูุงุช
                </button>
            </div>

            <!-- Notification Testing -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-test-tube"></i>
                    ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช
                </h3>
                <div class="notification-testing">
                    <button class="btn btn-primary" onclick="testNotificationPage()">
                        <i class="fas fa-external-link-alt"></i>
                        ูุชุญ ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช
                    </button>
                    <button class="btn btn-primary" onclick="testNotificationBadge()">
                        <i class="fas fa-bell"></i>
                        ุงุฎุชุจุงุฑ ุดุงุฑุฉ ุงูุฅุดุนุงุฑุงุช
                    </button>
                    <button class="btn btn-secondary" onclick="clearAllNotifications()">
                        <i class="fas fa-trash"></i>
                        ูุณุญ ุฌููุน ุงูุฅุดุนุงุฑุงุช
                    </button>
                </div>
            </div>

            <!-- Debug Log -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-bug"></i>
                    ุณุฌู ุงูุชุตุญูุญ
                </h3>
                <div class="debug-log" id="debugLog">
                    <p>ุณุชุธูุฑ ููุง ุฑุณุงุฆู ุงูุชุตุญูุญ...</p>
                </div>
                <button class="btn btn-secondary" onclick="clearDebugLog()">
                    <i class="fas fa-eraser"></i>
                    ูุณุญ ุงูุณุฌู
                </button>
            </div>
        </div>
    </section>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('๐ Initializing enhanced notifications test page...');
            updateCurrentUserInfo();
            refreshData();
            addDebugLog('ุชู ุชุญููู ุตูุญุฉ ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช ุงููุญุณู');
        });

        // Login as renter
        function loginAsRenter() {
            try {
                const renterData = {
                    id: 'test-renter',
                    full_name: 'ูุณุชุฃุฌุฑ ุชุฌุฑูุจู',
                    email: 'renter@example.com',
                    user_type: 'renter'
                };
                
                localStorage.setItem('userData', JSON.stringify(renterData));
                localStorage.setItem('userToken', 'mock-token-renter');
                localStorage.setItem('userType', 'renter');
                
                updateCurrentUserInfo();
                addDebugLog('โ ุชู ุชุณุฌูู ุฏุฎูู ููุณุชุฃุฌุฑ');
                
            } catch (error) {
                console.error('โ Error logging in as renter:', error);
                addDebugLog('โ ุฎุทุฃ ูู ุชุณุฌูู ุฏุฎูู ุงููุณุชุฃุฌุฑ: ' + error.message);
            }
        }

        // Login as owner
        function loginAsOwner() {
            try {
                const ownerData = {
                    id: 'test-owner',
                    full_name: 'ูุงูู ุงูุณูุงุฑุฉ ุงูุชุฌุฑูุจู',
                    email: 'owner@example.com',
                    user_type: 'owner'
                };
                
                localStorage.setItem('userData', JSON.stringify(ownerData));
                localStorage.setItem('userToken', 'mock-token-owner');
                localStorage.setItem('userType', 'owner');
                
                updateCurrentUserInfo();
                addDebugLog('โ ุชู ุชุณุฌูู ุฏุฎูู ููุงูู ุณูุงุฑุฉ');
                
            } catch (error) {
                console.error('โ Error logging in as owner:', error);
                addDebugLog('โ ุฎุทุฃ ูู ุชุณุฌูู ุฏุฎูู ูุงูู ุงูุณูุงุฑุฉ: ' + error.message);
            }
        }

        // Clear user data
        function clearUserData() {
            try {
                localStorage.removeItem('userData');
                localStorage.removeItem('userToken');
                localStorage.removeItem('userType');
                
                updateCurrentUserInfo();
                addDebugLog('๐๏ธ ุชู ูุณุญ ุจูุงูุงุช ุงููุณุชุฎุฏู');
                
            } catch (error) {
                console.error('โ Error clearing user data:', error);
                addDebugLog('โ ุฎุทุฃ ูู ูุณุญ ุจูุงูุงุช ุงููุณุชุฎุฏู: ' + error.message);
            }
        }

        // Update current user info
        function updateCurrentUserInfo() {
            try {
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                const userType = localStorage.getItem('userType');
                
                const userInfoDiv = document.getElementById('currentUserInfo');
                
                if (userData.id) {
                    userInfoDiv.innerHTML = `
                        <div class="user-info">
                            <strong>ุงููุณุชุฎุฏู ุงูุญุงูู:</strong> ${userData.full_name}<br>
                            <strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> ${userData.email}<br>
                            <strong>ุงูููุน:</strong> ${userType || 'ุบูุฑ ูุญุฏุฏ'}<br>
                            <strong>ุงููุนุฑู:</strong> ${userData.id}
                        </div>
                    `;
                } else {
                    userInfoDiv.innerHTML = '<p>ูู ูุชู ุชุณุฌูู ุฏุฎูู ุฃู ูุณุชุฎุฏู</p>';
                }
                
            } catch (error) {
                console.error('โ Error updating user info:', error);
            }
        }

        // Create test notification
        function createTestNotification() {
            try {
                const type = document.getElementById('notificationType').value;
                const title = document.getElementById('notificationTitle').value || 'ุฅุดุนุงุฑ ุชุฌุฑูุจู';
                const description = document.getElementById('notificationDescription').value || 'ูุตู ุชุฌุฑูุจู ููุฅุดุนุงุฑ';
                
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                if (!userData.id) {
                    addDebugLog('โ ูุฑุฌู ุชุณุฌูู ุฏุฎูู ูุณุชุฎุฏู ุฃููุงู');
                    return;
                }
                
                const notificationData = {
                    id: 'test-notification-' + Date.now(),
                    user_id: userData.id,
                    type: type,
                    title: title,
                    description: description,
                    related_id: 'test-booking-' + Date.now(),
                    related_type: 'booking',
                    is_read: false,
                    created_at: new Date().toISOString()
                };
                
                // Store notification
                const mockNotifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                mockNotifications.push(notificationData);
                localStorage.setItem('mockNotifications', JSON.stringify(mockNotifications));
                
                addDebugLog(`โ ุชู ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฌุฑูุจู ูููุณุชุฎุฏู ${userData.full_name}`);
                addDebugLog(`๐ ุชูุงุตูู ุงูุฅุดุนุงุฑ: ${type} - ${title}`);
                
                refreshData();
                
            } catch (error) {
                console.error('โ Error creating test notification:', error);
                addDebugLog('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฅุดุนุงุฑ ุงูุชุฌุฑูุจู: ' + error.message);
            }
        }

        // Simulate photo upload
        function simulatePhotoUpload() {
            try {
                const photoType = document.getElementById('photoType').value;
                const photoDescription = document.getElementById('photoDescription').value || 'ุตูุฑ ูุฑููุนุฉ ุชุฌุฑูุจูุงู';
                
                // Create booking data if not exists
                const bookingData = {
                    id: 'test-booking-1',
                    renter_id: 'test-renter',
                    owner_id: 'test-owner',
                    car_name: 'ุชูููุชุง ูุงูุฑู 2023',
                    status: 'approved'
                };
                
                // Create notification for car owner
                const notificationData = {
                    id: 'photo-notification-' + Date.now(),
                    user_id: 'test-owner',
                    type: 'photo_uploaded',
                    title: 'ุชู ุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ููุญุฌุฒ',
                    description: `ูุงู ุงููุณุชุฃุฌุฑ ุจุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ูุญุฌุฒ ุณูุงุฑุฉ ${bookingData.car_name}`,
                    related_id: bookingData.id,
                    related_type: 'booking',
                    is_read: false,
                    created_at: new Date().toISOString(),
                    photo_type: photoType,
                    photo_description: photoDescription,
                    booking_details: {
                        car_name: bookingData.car_name,
                        renter_name: 'ูุณุชุฃุฌุฑ ุชุฌุฑูุจู',
                        booking_id: bookingData.id
                    }
                };
                
                // Store notification
                const mockNotifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                mockNotifications.push(notificationData);
                localStorage.setItem('mockNotifications', JSON.stringify(mockNotifications));
                
                // Store booking if not exists
                const mockBookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                const existingBooking = mockBookings.find(b => b.id === bookingData.id);
                if (!existingBooking) {
                    mockBookings.push(bookingData);
                    localStorage.setItem('mockBookings', JSON.stringify(mockBookings));
                }
                
                addDebugLog('โ ุชู ูุญุงูุงุฉ ุฑูุน ุงูุตูุฑ ูุฅูุดุงุก ุฅุดุนุงุฑ ููุงูู ุงูุณูุงุฑุฉ');
                addDebugLog(`๐ธ ููุน ุงูุตูุฑ: ${photoType}`);
                addDebugLog(`๐ ุงูุฅุดุนุงุฑ: ${notificationData.title}`);
                
                refreshData();
                
            } catch (error) {
                console.error('โ Error simulating photo upload:', error);
                addDebugLog('โ ุฎุทุฃ ูู ูุญุงูุงุฉ ุฑูุน ุงูุตูุฑ: ' + error.message);
            }
        }

        // Refresh data display
        function refreshData() {
            try {
                // Users data
                const users = JSON.parse(localStorage.getItem('mockUsers') || '[]');
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                if (userData.id) {
                    users.push(userData);
                }
                
                document.getElementById('usersData').innerHTML = `
                    <strong>ุนุฏุฏ ุงููุณุชุฎุฏููู:</strong> ${users.length}<br>
                    ${users.map(u => `${u.full_name} (${u.id})`).join('<br>')}
                `;
                
                // Notifications data
                const notifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                const unreadCount = notifications.filter(n => !n.is_read).length;
                
                document.getElementById('notificationsData').innerHTML = `
                    <strong>ุฅุฌูุงูู ุงูุฅุดุนุงุฑุงุช:</strong> ${notifications.length}<br>
                    <strong>ุบูุฑ ููุฑูุกุฉ:</strong> ${unreadCount}<br>
                    ${notifications.slice(-3).map(n => `${n.title} (${n.user_id})`).join('<br>')}
                `;
                
                // Bookings data
                const bookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                
                document.getElementById('bookingsData').innerHTML = `
                    <strong>ุนุฏุฏ ุงูุญุฌูุฒุงุช:</strong> ${bookings.length}<br>
                    ${bookings.map(b => `${b.car_name} (${b.status})`).join('<br>')}
                `;
                
                addDebugLog('๐ ุชู ุชุญุฏูุซ ุนุฑุถ ุงูุจูุงูุงุช');
                
            } catch (error) {
                console.error('โ Error refreshing data:', error);
                addDebugLog('โ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุจูุงูุงุช: ' + error.message);
            }
        }

        // Test notification page
        function testNotificationPage() {
            try {
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                if (!userData.id) {
                    addDebugLog('โ ูุฑุฌู ุชุณุฌูู ุฏุฎูู ูุณุชุฎุฏู ุฃููุงู');
                    return;
                }
                
                addDebugLog('๐ ูุชุญ ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช...');
                window.open('notifications.html', '_blank');
                
            } catch (error) {
                console.error('โ Error opening notification page:', error);
                addDebugLog('โ ุฎุทุฃ ูู ูุชุญ ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช: ' + error.message);
            }
        }

        // Test notification badge
        function testNotificationBadge() {
            try {
                const notifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                
                if (!userData.id) {
                    addDebugLog('โ ูุฑุฌู ุชุณุฌูู ุฏุฎูู ูุณุชุฎุฏู ุฃููุงู');
                    return;
                }
                
                const userNotifications = notifications.filter(n => n.user_id === userData.id);
                const unreadCount = userNotifications.filter(n => !n.is_read).length;
                
                addDebugLog(`๐ ุงุฎุชุจุงุฑ ุดุงุฑุฉ ุงูุฅุดุนุงุฑุงุช ูููุณุชุฎุฏู ${userData.full_name}`);
                addDebugLog(`๐ ุฅุฌูุงูู ุงูุฅุดุนุงุฑุงุช: ${userNotifications.length}`);
                addDebugLog(`๐ ุบูุฑ ููุฑูุกุฉ: ${unreadCount}`);
                
                // Update badge if exists
                const badge = document.getElementById('notificationBadge');
                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.style.display = 'inline';
                        addDebugLog(`โ ุชู ุชุญุฏูุซ ุงูุดุงุฑุฉ: ${unreadCount}`);
                    } else {
                        badge.style.display = 'none';
                        addDebugLog('โ ุชู ุฅุฎูุงุก ุงูุดุงุฑุฉ (ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช ุบูุฑ ููุฑูุกุฉ)');
                    }
                }
                
            } catch (error) {
                console.error('โ Error testing notification badge:', error);
                addDebugLog('โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุดุงุฑุฉ ุงูุฅุดุนุงุฑุงุช: ' + error.message);
            }
        }

        // Clear all notifications
        function clearAllNotifications() {
            try {
                if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ูุณุญ ุฌููุน ุงูุฅุดุนุงุฑุงุชุ')) {
                    localStorage.removeItem('mockNotifications');
                    addDebugLog('๐๏ธ ุชู ูุณุญ ุฌููุน ุงูุฅุดุนุงุฑุงุช');
                    refreshData();
                }
            } catch (error) {
                console.error('โ Error clearing notifications:', error);
                addDebugLog('โ ุฎุทุฃ ูู ูุณุญ ุงูุฅุดุนุงุฑุงุช: ' + error.message);
            }
        }

        // Add debug log
        function addDebugLog(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const logEntry = document.createElement('div');
            logEntry.className = 'debug-entry';
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
            
            console.log(message);
        }

        // Clear debug log
        function clearDebugLog() {
            const debugLog = document.getElementById('debugLog');
            debugLog.innerHTML = '<p>ุชู ูุณุญ ุงูุณุฌู...</p>';
        }
    </script>

    <style>
        .test-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .test-section h3 {
            margin: 0 0 1.5rem 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-controls, .notification-creator, .photo-upload-simulator, .notification-testing {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 200px;
        }

        .form-group label {
            font-weight: bold;
            color: #374151;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .current-user-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .user-info {
            line-height: 1.6;
        }

        .data-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .data-card {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .data-card h4 {
            margin: 0 0 0.5rem 0;
            color: #374151;
        }

        .debug-log {
            background: #1e1e1e;
            color: #ffffff;
            padding: 1rem;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .debug-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .timestamp {
            color: #10b981;
        }

        @media (max-width: 768px) {
            .user-controls, .notification-creator, .photo-upload-simulator, .notification-testing {
                flex-direction: column;
            }
            
            .data-display {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
