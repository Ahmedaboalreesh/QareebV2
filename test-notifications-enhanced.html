<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù† - Ù…Ù†ØµØ© ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <i class="fas fa-car"></i>
                        <span>Ù…Ù†ØµØ© ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</span>
                    </a>
                </div>
                <nav class="nav">
                    <a href="index.html">
                        <i class="fas fa-home"></i>
                        Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>
                    <i class="fas fa-bell"></i>
                    Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†
                </h1>
                <p>ØµÙØ­Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØªØµØ­ÙŠØ­ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</p>
            </div>

            <!-- User Management -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-user"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </h3>
                <div class="user-controls">
                    <button class="btn btn-primary" onclick="loginAsRenter()">
                        <i class="fas fa-user"></i>
                        ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³ØªØ£Ø¬Ø±
                    </button>
                    <button class="btn btn-primary" onclick="loginAsOwner()">
                        <i class="fas fa-user-tie"></i>
                        ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø§Ù„Ùƒ Ø³ÙŠØ§Ø±Ø©
                    </button>
                    <button class="btn btn-secondary" onclick="clearUserData()">
                        <i class="fas fa-trash"></i>
                        Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    </button>
                </div>
                <div class="current-user-info" id="currentUserInfo">
                    <p>Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù…</p>
                </div>
            </div>

            <!-- Notification Creation -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-plus"></i>
                    Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                </h3>
                <div class="notification-creator">
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:</label>
                        <select id="notificationType">
                            <option value="photo_uploaded">Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±</option>
                            <option value="booking_status_updated">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬Ø²</option>
                            <option value="review_received">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</option>
                            <option value="booking_created">Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯</option>
                            <option value="payment_received">Ø§Ù„Ø¯ÙØ¹</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
                        <input type="text" id="notificationTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØµÙ:</label>
                        <textarea id="notificationDescription" placeholder="ÙˆØµÙ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="createTestNotification()">
                        <i class="fas fa-plus"></i>
                        Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ
                    </button>
                </div>
            </div>

            <!-- Simulate Photo Upload -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-camera"></i>
                    Ù…Ø­Ø§ÙƒØ§Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±
                </h3>
                <div class="photo-upload-simulator">
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„ØµÙˆØ±Ø©:</label>
                        <select id="photoType">
                            <option value="exterior">ØµÙˆØ± Ø®Ø§Ø±Ø¬ÙŠØ©</option>
                            <option value="interior">ØµÙˆØ± Ø¯Ø§Ø®Ù„ÙŠØ©</option>
                            <option value="damage">ØµÙˆØ± Ø§Ù„Ø£Ø¶Ø±Ø§Ø±</option>
                            <option value="general">ØµÙˆØ± Ø¹Ø§Ù…Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ÙˆØµÙ Ø§Ù„ØµÙˆØ±:</label>
                        <textarea id="photoDescription" placeholder="ÙˆØµÙ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="simulatePhotoUpload()">
                        <i class="fas fa-upload"></i>
                        Ù…Ø­Ø§ÙƒØ§Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±
                    </button>
                </div>
            </div>

            <!-- Current Data -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-database"></i>
                    Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                </h3>
                <div class="data-display">
                    <div class="data-card">
                        <h4>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h4>
                        <div id="usersData">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                    <div class="data-card">
                        <h4>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h4>
                        <div id="notificationsData">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                    <div class="data-card">
                        <h4>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h4>
                        <div id="bookingsData">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="refreshData()">
                    <i class="fas fa-refresh"></i>
                    ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
            </div>

            <!-- Notification Testing -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-test-tube"></i>
                    Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                </h3>
                <div class="notification-testing">
                    <button class="btn btn-primary" onclick="testNotificationPage()">
                        <i class="fas fa-external-link-alt"></i>
                        ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                    </button>
                    <button class="btn btn-primary" onclick="testNotificationBadge()">
                        <i class="fas fa-bell"></i>
                        Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                    </button>
                    <button class="btn btn-secondary" onclick="clearAllNotifications()">
                        <i class="fas fa-trash"></i>
                        Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                    </button>
                </div>
            </div>

            <!-- Debug Log -->
            <div class="test-section">
                <h3>
                    <i class="fas fa-bug"></i>
                    Ø³Ø¬Ù„ Ø§Ù„ØªØµØ­ÙŠØ­
                </h3>
                <div class="debug-log" id="debugLog">
                    <p>Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØµØ­ÙŠØ­...</p>
                </div>
                <button class="btn btn-secondary" onclick="clearDebugLog()">
                    <i class="fas fa-eraser"></i>
                    Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
                </button>
            </div>
        </div>
    </section>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” Initializing enhanced notifications test page...');
            updateCurrentUserInfo();
            refreshData();
            addDebugLog('ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†');
        });

        // Login as renter
        function loginAsRenter() {
            try {
                const renterData = {
                    id: 'test-renter',
                    full_name: 'Ù…Ø³ØªØ£Ø¬Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ',
                    email: 'renter@example.com',
                    user_type: 'renter'
                };
                
                localStorage.setItem('userData', JSON.stringify(renterData));
                localStorage.setItem('userToken', 'mock-token-renter');
                localStorage.setItem('userType', 'renter');
                
                updateCurrentUserInfo();
                addDebugLog('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³ØªØ£Ø¬Ø±');
                
            } catch (error) {
                console.error('âŒ Error logging in as renter:', error);
                addDebugLog('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±: ' + error.message);
            }
        }

        // Login as owner
        function loginAsOwner() {
            try {
                const ownerData = {
                    id: 'test-owner',
                    full_name: 'Ù…Ø§Ù„Ùƒ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ',
                    email: 'owner@example.com',
                    user_type: 'owner'
                };
                
                localStorage.setItem('userData', JSON.stringify(ownerData));
                localStorage.setItem('userToken', 'mock-token-owner');
                localStorage.setItem('userType', 'owner');
                
                updateCurrentUserInfo();
                addDebugLog('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø§Ù„Ùƒ Ø³ÙŠØ§Ø±Ø©');
                
            } catch (error) {
                console.error('âŒ Error logging in as owner:', error);
                addDebugLog('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø§Ù„Ùƒ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ' + error.message);
            }
        }

        // Clear user data
        function clearUserData() {
            try {
                localStorage.removeItem('userData');
                localStorage.removeItem('userToken');
                localStorage.removeItem('userType');
                
                updateCurrentUserInfo();
                addDebugLog('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                
            } catch (error) {
                console.error('âŒ Error clearing user data:', error);
                addDebugLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ' + error.message);
            }
        }

        // Update current user info
        function updateCurrentUserInfo() {
            try {
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                const userType = localStorage.getItem('userType');
                
                const userInfoDiv = document.getElementById('currentUserInfo');
                
                if (userData.id) {
                    userInfoDiv.innerHTML = `
                        <div class="user-info">
                            <strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> ${userData.full_name}<br>
                            <strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${userData.email}<br>
                            <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${userType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                            <strong>Ø§Ù„Ù…Ø¹Ø±Ù:</strong> ${userData.id}
                        </div>
                    `;
                } else {
                    userInfoDiv.innerHTML = '<p>Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù…</p>';
                }
                
            } catch (error) {
                console.error('âŒ Error updating user info:', error);
            }
        }

        // Create test notification
        function createTestNotification() {
            try {
                const type = document.getElementById('notificationType').value;
                const title = document.getElementById('notificationTitle').value || 'Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ';
                const description = document.getElementById('notificationDescription').value || 'ÙˆØµÙ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±';
                
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                if (!userData.id) {
                    addDebugLog('âŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹');
                    return;
                }
                
                const notificationData = {
                    id: 'test-notification-' + Date.now(),
                    user_id: userData.id,
                    type: type,
                    title: title,
                    description: description,
                    related_id: 'test-booking-' + Date.now(),
                    related_type: 'booking',
                    is_read: false,
                    created_at: new Date().toISOString()
                };
                
                // Store notification
                const mockNotifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                mockNotifications.push(notificationData);
                localStorage.setItem('mockNotifications', JSON.stringify(mockNotifications));
                
                addDebugLog(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userData.full_name}`);
                addDebugLog(`ğŸ”” ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: ${type} - ${title}`);
                
                refreshData();
                
            } catch (error) {
                console.error('âŒ Error creating test notification:', error);
                addDebugLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ: ' + error.message);
            }
        }

        // Simulate photo upload
        function simulatePhotoUpload() {
            try {
                const photoType = document.getElementById('photoType').value;
                const photoDescription = document.getElementById('photoDescription').value || 'ØµÙˆØ± Ù…Ø±ÙÙˆØ¹Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ§Ù‹';
                
                // Create booking data if not exists
                const bookingData = {
                    id: 'test-booking-1',
                    renter_id: 'test-renter',
                    owner_id: 'test-owner',
                    car_name: 'ØªÙˆÙŠÙˆØªØ§ ÙƒØ§Ù…Ø±ÙŠ 2023',
                    status: 'approved'
                };
                
                // Create notification for car owner
                const notificationData = {
                    id: 'photo-notification-' + Date.now(),
                    user_id: 'test-owner',
                    type: 'photo_uploaded',
                    title: 'ØªÙ… Ø±ÙØ¹ ØµÙˆØ± Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø­Ø¬Ø²',
                    description: `Ù‚Ø§Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ø¨Ø±ÙØ¹ ØµÙˆØ± Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø­Ø¬Ø² Ø³ÙŠØ§Ø±Ø© ${bookingData.car_name}`,
                    related_id: bookingData.id,
                    related_type: 'booking',
                    is_read: false,
                    created_at: new Date().toISOString(),
                    photo_type: photoType,
                    photo_description: photoDescription,
                    booking_details: {
                        car_name: bookingData.car_name,
                        renter_name: 'Ù…Ø³ØªØ£Ø¬Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ',
                        booking_id: bookingData.id
                    }
                };
                
                // Store notification
                const mockNotifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                mockNotifications.push(notificationData);
                localStorage.setItem('mockNotifications', JSON.stringify(mockNotifications));
                
                // Store booking if not exists
                const mockBookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                const existingBooking = mockBookings.find(b => b.id === bookingData.id);
                if (!existingBooking) {
                    mockBookings.push(bookingData);
                    localStorage.setItem('mockBookings', JSON.stringify(mockBookings));
                }
                
                addDebugLog('âœ… ØªÙ… Ù…Ø­Ø§ÙƒØ§Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù…Ø§Ù„Ùƒ Ø§Ù„Ø³ÙŠØ§Ø±Ø©');
                addDebugLog(`ğŸ“¸ Ù†ÙˆØ¹ Ø§Ù„ØµÙˆØ±: ${photoType}`);
                addDebugLog(`ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: ${notificationData.title}`);
                
                refreshData();
                
            } catch (error) {
                console.error('âŒ Error simulating photo upload:', error);
                addDebugLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±: ' + error.message);
            }
        }

        // Refresh data display
        function refreshData() {
            try {
                // Users data
                const users = JSON.parse(localStorage.getItem('mockUsers') || '[]');
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                if (userData.id) {
                    users.push(userData);
                }
                
                document.getElementById('usersData').innerHTML = `
                    <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:</strong> ${users.length}<br>
                    ${users.map(u => `${u.full_name} (${u.id})`).join('<br>')}
                `;
                
                // Notifications data
                const notifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                const unreadCount = notifications.filter(n => !n.is_read).length;
                
                document.getElementById('notificationsData').innerHTML = `
                    <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:</strong> ${notifications.length}<br>
                    <strong>ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©:</strong> ${unreadCount}<br>
                    ${notifications.slice(-3).map(n => `${n.title} (${n.user_id})`).join('<br>')}
                `;
                
                // Bookings data
                const bookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                
                document.getElementById('bookingsData').innerHTML = `
                    <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª:</strong> ${bookings.length}<br>
                    ${bookings.map(b => `${b.car_name} (${b.status})`).join('<br>')}
                `;
                
                addDebugLog('ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                
            } catch (error) {
                console.error('âŒ Error refreshing data:', error);
                addDebugLog('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
            }
        }

        // Test notification page
        function testNotificationPage() {
            try {
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                if (!userData.id) {
                    addDebugLog('âŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹');
                    return;
                }
                
                addDebugLog('ğŸ”— ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª...');
                window.open('notifications.html', '_blank');
                
            } catch (error) {
                console.error('âŒ Error opening notification page:', error);
                addDebugLog('âŒ Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ' + error.message);
            }
        }

        // Test notification badge
        function testNotificationBadge() {
            try {
                const notifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                
                if (!userData.id) {
                    addDebugLog('âŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹');
                    return;
                }
                
                const userNotifications = notifications.filter(n => n.user_id === userData.id);
                const unreadCount = userNotifications.filter(n => !n.is_read).length;
                
                addDebugLog(`ğŸ”” Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userData.full_name}`);
                addDebugLog(`ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ${userNotifications.length}`);
                addDebugLog(`ğŸ“Š ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©: ${unreadCount}`);
                
                // Update badge if exists
                const badge = document.getElementById('notificationBadge');
                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.style.display = 'inline';
                        addDebugLog(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø±Ø©: ${unreadCount}`);
                    } else {
                        badge.style.display = 'none';
                        addDebugLog('âœ… ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø§Ø±Ø© (Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©)');
                    }
                }
                
            } catch (error) {
                console.error('âŒ Error testing notification badge:', error);
                addDebugLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ' + error.message);
            }
        }

        // Clear all notifications
        function clearAllNotifications() {
            try {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§ØªØŸ')) {
                    localStorage.removeItem('mockNotifications');
                    addDebugLog('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª');
                    refreshData();
                }
            } catch (error) {
                console.error('âŒ Error clearing notifications:', error);
                addDebugLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ' + error.message);
            }
        }

        // Add debug log
        function addDebugLog(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const logEntry = document.createElement('div');
            logEntry.className = 'debug-entry';
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
            
            console.log(message);
        }

        // Clear debug log
        function clearDebugLog() {
            const debugLog = document.getElementById('debugLog');
            debugLog.innerHTML = '<p>ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„...</p>';
        }
    </script>

    <style>
        .test-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .test-section h3 {
            margin: 0 0 1.5rem 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-controls, .notification-creator, .photo-upload-simulator, .notification-testing {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 200px;
        }

        .form-group label {
            font-weight: bold;
            color: #374151;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .current-user-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .user-info {
            line-height: 1.6;
        }

        .data-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .data-card {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .data-card h4 {
            margin: 0 0 0.5rem 0;
            color: #374151;
        }

        .debug-log {
            background: #1e1e1e;
            color: #ffffff;
            padding: 1rem;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .debug-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .timestamp {
            color: #10b981;
        }

        @media (max-width: 768px) {
            .user-controls, .notification-creator, .photo-upload-simulator, .notification-testing {
                flex-direction: column;
            }
            
            .data-display {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
