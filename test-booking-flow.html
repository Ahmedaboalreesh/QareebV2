<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุชุฏูู ุงูุญุฌุฒ ูุงูุฏูุน - ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <i class="fas fa-car"></i>
                        <span>ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช</span>
                    </a>
                </div>
                <nav class="nav">
                    <a href="index.html">
                        <i class="fas fa-home"></i>
                        ุงูุฑุฆูุณูุฉ
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>
                    <i class="fas fa-route"></i>
                    ุงุฎุชุจุงุฑ ุชุฏูู ุงูุญุฌุฒ ูุงูุฏูุน
                </h1>
                <p>ุตูุญุฉ ูุงุฎุชุจุงุฑ ุนูููุฉ ุงูุญุฌุฒ ูุงูุงูุชูุงู ูุตูุญุฉ ุงูุฏูุน</p>
            </div>

            <!-- Test Steps -->
            <div class="test-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ</h3>
                        <p>ุฅูุดุงุก ุณูุงุฑุฉ ุชุฌุฑูุจูุฉ ูุญูุธูุง ูู localStorage</p>
                        <button class="btn btn-primary" onclick="createTestData()">
                            <i class="fas fa-plus"></i>
                            ุฅูุดุงุก ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
                        </button>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>ูุญุงูุงุฉ ุตูุญุฉ ุชูุงุตูู ุงูุณูุงุฑุฉ</h3>
                        <p>ูุญุงูุงุฉ ุนุฑุถ ุชูุงุตูู ุงูุณูุงุฑุฉ ูุฅูุดุงุก ุงูุญุฌุฒ</p>
                        <button class="btn btn-primary" onclick="simulateCarDetails()">
                            <i class="fas fa-car"></i>
                            ูุญุงูุงุฉ ุชูุงุตูู ุงูุณูุงุฑุฉ
                        </button>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>ุงุฎุชุจุงุฑ ุงูุงูุชูุงู ูุตูุญุฉ ุงูุฏูุน</h3>
                        <p>ุงูุงูุชูุงู ูุตูุญุฉ ุงูุฏูุน ูุน ุจูุงูุงุช ุงูุญุฌุฒ</p>
                        <button class="btn btn-primary" onclick="testPaymentRedirect()">
                            <i class="fas fa-credit-card"></i>
                            ุงุฎุชุจุงุฑ ุตูุญุฉ ุงูุฏูุน
                        </button>
                    </div>
                </div>
            </div>

            <!-- Current Data -->
            <div class="data-section">
                <div class="data-card">
                    <h3>
                        <i class="fas fa-database"></i>
                        ุงูุจูุงูุงุช ุงูุญุงููุฉ
                    </h3>
                    <div class="data-content">
                        <div class="data-item">
                            <strong>ุงูุณูุงุฑุงุช:</strong>
                            <span id="carsCount">0</span>
                        </div>
                        <div class="data-item">
                            <strong>ุงูุญุฌูุฒุงุช:</strong>
                            <span id="bookingsCount">0</span>
                        </div>
                        <div class="data-item">
                            <strong>ุงููุฏููุนุงุช:</strong>
                            <span id="paymentsCount">0</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="clearAllData()">
                        <i class="fas fa-trash"></i>
                        ูุณุญ ุฌููุน ุงูุจูุงูุงุช
                    </button>
                </div>
            </div>

            <!-- Debug Info -->
            <div class="debug-section">
                <h3>
                    <i class="fas fa-bug"></i>
                    ูุนูููุงุช ุงูุชุตุญูุญ
                </h3>
                <div class="debug-content" id="debugInfo">
                    <p>ุณุชุธูุฑ ููุง ูุนูููุงุช ุงูุชุตุญูุญ...</p>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="quick-links">
                <h3>
                    <i class="fas fa-link"></i>
                    ุฑูุงุจุท ุณุฑูุนุฉ
                </h3>
                <div class="links-grid">
                    <a href="car-details.html?id=1" class="link-card">
                        <i class="fas fa-car"></i>
                        <span>ุตูุญุฉ ุชูุงุตูู ุงูุณูุงุฑุฉ</span>
                    </a>
                    <a href="payment.html?booking_id=test" class="link-card">
                        <i class="fas fa-credit-card"></i>
                        <span>ุตูุญุฉ ุงูุฏูุน</span>
                    </a>
                    <a href="test-payment.html" class="link-card">
                        <i class="fas fa-cogs"></i>
                        <span>ุงุฎุชุจุงุฑ ูุธุงู ุงูุฏูุน</span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('๐ Initializing booking flow test page...');
            updateDataCounts();
            addDebugInfo('ุชู ุชุญููู ุตูุญุฉ ุงุฎุชุจุงุฑ ุชุฏูู ุงูุญุฌุฒ ูุงูุฏูุน');
        });

        // Create test data
        function createTestData() {
            try {
                // Create test car
                const testCar = {
                    id: '1',
                    brand: 'ุชูููุชุง',
                    model: 'ูุงูุฑู',
                    year: '2023',
                    daily_rate: 150,
                    deposit: 500,
                    owner_name: 'ุฃุญูุฏ ูุญูุฏ',
                    location: 'ุงูุฑูุงุถ',
                    transmission: 'ุฃูุชููุงุชูู',
                    fuel_type: 'ุจูุฒูู',
                    mileage: 25000,
                    description: 'ุณูุงุฑุฉ ููุชุงุฒุฉ ูู ุญุงูุฉ ุฌูุฏุฉุ ููููุฉ ุจุงููุงููุ ููุงุณุจุฉ ููุฑุญูุงุช ุงูุนุงุฆููุฉ ูุงูุชููู ุงููููู.',
                    features: ['ac', 'bluetooth', 'gps', 'backup_camera', 'cruise_control'],
                    photos: [
                        { filename: 'car1.jpg' },
                        { filename: 'car2.jpg' },
                        { filename: 'car3.jpg' }
                    ]
                };

                // Save car to localStorage
                const existingCars = JSON.parse(localStorage.getItem('mockCars') || '[]');
                const carExists = existingCars.find(c => c.id === testCar.id);
                if (!carExists) {
                    existingCars.push(testCar);
                    localStorage.setItem('mockCars', JSON.stringify(existingCars));
                }

                addDebugInfo('โ ุชู ุฅูุดุงุก ุจูุงูุงุช ุงูุณูุงุฑุฉ ุงูุชุฌุฑูุจูุฉ');
                updateDataCounts();

            } catch (error) {
                console.error('โ Error creating test data:', error);
                addDebugInfo('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ: ' + error.message);
            }
        }

        // Simulate car details page
        function simulateCarDetails() {
            try {
                // Check if car exists
                const cars = JSON.parse(localStorage.getItem('mockCars') || '[]');
                const car = cars.find(c => c.id === '1');

                if (!car) {
                    addDebugInfo('โ ูุง ุชูุฌุฏ ุณูุงุฑุฉ ุชุฌุฑูุจูุฉ. ูุฑุฌู ุฅูุดุงุก ุงูุจูุงูุงุช ุฃููุงู.');
                    return;
                }

                addDebugInfo('โ ุชู ุงูุนุซูุฑ ุนูู ุงูุณูุงุฑุฉ ุงูุชุฌุฑูุจูุฉ');
                addDebugInfo(`๐ ุงูุณูุงุฑุฉ: ${car.brand} ${car.model} ${car.year}`);
                addDebugInfo(`๐ฐ ุงูุณุนุฑ ุงููููู: ${car.daily_rate} ุฑูุงู`);

                // Simulate booking creation
                const testBooking = {
                    id: Date.now(),
                    car_id: car.id,
                    start_date: '2024-01-15',
                    end_date: '2024-01-18',
                    status: 'pending',
                    total_amount: 450, // 3 days * 150 SAR
                    deposit_amount: car.deposit
                };

                // Save booking to localStorage
                const existingBookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                existingBookings.push(testBooking);
                localStorage.setItem('mockBookings', JSON.stringify(existingBookings));

                addDebugInfo('โ ุชู ุฅูุดุงุก ุญุฌุฒ ุชุฌุฑูุจู');
                addDebugInfo(`๐ ุงูุชูุงุฑูุฎ: ${testBooking.start_date} - ${testBooking.end_date}`);
                addDebugInfo(`๐ต ุงููุจูุบ ุงูุฅุฌูุงูู: ${testBooking.total_amount} ุฑูุงู`);
                updateDataCounts();

            } catch (error) {
                console.error('โ Error simulating car details:', error);
                addDebugInfo('โ ุฎุทุฃ ูู ูุญุงูุงุฉ ุชูุงุตูู ุงูุณูุงุฑุฉ: ' + error.message);
            }
        }

        // Test payment redirect
        function testPaymentRedirect() {
            try {
                // Check if booking exists
                const bookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                const latestBooking = bookings[bookings.length - 1];

                if (!latestBooking) {
                    addDebugInfo('โ ูุง ุชูุฌุฏ ุญุฌูุฒุงุช. ูุฑุฌู ุฅูุดุงุก ุญุฌุฒ ุฃููุงู.');
                    return;
                }

                addDebugInfo('โ ุชู ุงูุนุซูุฑ ุนูู ุงูุญุฌุฒ ุงูุชุฌุฑูุจู');
                addDebugInfo(`๐ ูุนุฑู ุงูุญุฌุฒ: ${latestBooking.id}`);
                addDebugInfo('๐ ุฌุงุฑู ุงูุงูุชูุงู ูุตูุญุฉ ุงูุฏูุน...');

                // Redirect to payment page
                setTimeout(() => {
                    window.location.href = `payment.html?booking_id=${latestBooking.id}`;
                }, 2000);

            } catch (error) {
                console.error('โ Error testing payment redirect:', error);
                addDebugInfo('โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุงูุงูุชูุงู ูุตูุญุฉ ุงูุฏูุน: ' + error.message);
            }
        }

        // Update data counts
        function updateDataCounts() {
            try {
                const cars = JSON.parse(localStorage.getItem('mockCars') || '[]');
                const bookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                const payments = JSON.parse(localStorage.getItem('mockPayments') || '[]');

                document.getElementById('carsCount').textContent = cars.length;
                document.getElementById('bookingsCount').textContent = bookings.length;
                document.getElementById('paymentsCount').textContent = payments.length;

            } catch (error) {
                console.error('โ Error updating data counts:', error);
            }
        }

        // Clear all data
        function clearAllData() {
            try {
                localStorage.removeItem('mockCars');
                localStorage.removeItem('mockBookings');
                localStorage.removeItem('mockPayments');

                addDebugInfo('๐๏ธ ุชู ูุณุญ ุฌููุน ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ');
                updateDataCounts();

            } catch (error) {
                console.error('โ Error clearing data:', error);
                addDebugInfo('โ ุฎุทุฃ ูู ูุณุญ ุงูุจูุงูุงุช: ' + error.message);
            }
        }

        // Add debug info
        function addDebugInfo(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const logEntry = document.createElement('div');
            logEntry.className = 'debug-entry';
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            
            debugInfo.appendChild(logEntry);
            debugInfo.scrollTop = debugInfo.scrollHeight;
            
            console.log(message);
        }
    </script>

    <style>
        .test-steps {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .step-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content h3 {
            margin: 0 0 0.5rem 0;
            color: #374151;
        }

        .step-content p {
            margin: 0 0 1rem 0;
            color: #6b7280;
        }

        .data-section {
            margin-bottom: 3rem;
        }

        .data-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
        }

        .data-card h3 {
            margin: 0 0 1.5rem 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .data-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .debug-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 3rem;
        }

        .debug-section h3 {
            margin: 0 0 1rem 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .debug-content {
            background: #1e1e1e;
            color: #ffffff;
            padding: 1rem;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .debug-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .timestamp {
            color: #10b981;
        }

        .quick-links {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
        }

        .quick-links h3 {
            margin: 0 0 1.5rem 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .link-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            text-decoration: none;
            color: #374151;
            transition: all 0.3s ease;
        }

        .link-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .link-card i {
            font-size: 1.5rem;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .step {
                flex-direction: column;
                text-align: center;
            }
            
            .data-content {
                grid-template-columns: 1fr;
            }
            
            .links-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
