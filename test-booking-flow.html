<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± ØªØ¯ÙÙ‚ Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø¯ÙØ¹ - Ù…Ù†ØµØ© ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <i class="fas fa-car"></i>
                        <span>Ù…Ù†ØµØ© ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</span>
                    </a>
                </div>
                <nav class="nav">
                    <a href="index.html">
                        <i class="fas fa-home"></i>
                        Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>
                    <i class="fas fa-route"></i>
                    Ø§Ø®ØªØ¨Ø§Ø± ØªØ¯ÙÙ‚ Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø¯ÙØ¹
                </h1>
                <p>ØµÙØ­Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹</p>
            </div>

            <!-- Test Steps -->
            <div class="test-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h3>
                        <p>Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ localStorage</p>
                        <button class="btn btn-primary" onclick="createTestData()">
                            <i class="fas fa-plus"></i>
                            Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                        </button>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Ù…Ø­Ø§ÙƒØ§Ø© ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h3>
                        <p>Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø²</p>
                        <button class="btn btn-primary" onclick="simulateCarDetails()">
                            <i class="fas fa-car"></i>
                            Ù…Ø­Ø§ÙƒØ§Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                        </button>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹</h3>
                        <p>Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²</p>
                        <button class="btn btn-primary" onclick="testPaymentRedirect()">
                            <i class="fas fa-credit-card"></i>
                            Ø§Ø®ØªØ¨Ø§Ø± ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
                        </button>
                    </div>
                </div>
            </div>

            <!-- Current Data -->
            <div class="data-section">
                <div class="data-card">
                    <h3>
                        <i class="fas fa-database"></i>
                        Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    </h3>
                    <div class="data-content">
                        <div class="data-item">
                            <strong>Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª:</strong>
                            <span id="carsCount">0</span>
                        </div>
                        <div class="data-item">
                            <strong>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª:</strong>
                            <span id="bookingsCount">0</span>
                        </div>
                        <div class="data-item">
                            <strong>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª:</strong>
                            <span id="paymentsCount">0</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="clearAllData()">
                        <i class="fas fa-trash"></i>
                        Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
            </div>

            <!-- Debug Info -->
            <div class="debug-section">
                <h3>
                    <i class="fas fa-bug"></i>
                    Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­
                </h3>
                <div class="debug-content" id="debugInfo">
                    <p>Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­...</p>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="quick-links">
                <h3>
                    <i class="fas fa-link"></i>
                    Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©
                </h3>
                <div class="links-grid">
                    <a href="car-details.html?id=1" class="link-card">
                        <i class="fas fa-car"></i>
                        <span>ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</span>
                    </a>
                    <a href="payment.html?booking_id=test" class="link-card">
                        <i class="fas fa-credit-card"></i>
                        <span>ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹</span>
                    </a>
                    <a href="test-payment.html" class="link-card">
                        <i class="fas fa-cogs"></i>
                        <span>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹</span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” Initializing booking flow test page...');
            updateDataCounts();
            addDebugInfo('ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± ØªØ¯ÙÙ‚ Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø¯ÙØ¹');
        });

        // Create test data
        function createTestData() {
            try {
                // Create test car
                const testCar = {
                    id: '1',
                    brand: 'ØªÙˆÙŠÙˆØªØ§',
                    model: 'ÙƒØ§Ù…Ø±ÙŠ',
                    year: '2023',
                    daily_rate: 150,
                    deposit: 500,
                    owner_name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                    location: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                    transmission: 'Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ',
                    fuel_type: 'Ø¨Ù†Ø²ÙŠÙ†',
                    mileage: 25000,
                    description: 'Ø³ÙŠØ§Ø±Ø© Ù…Ù…ØªØ§Ø²Ø© ÙÙŠ Ø­Ø§Ù„Ø© Ø¬ÙŠØ¯Ø©ØŒ Ù…ÙƒÙŠÙØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ© ÙˆØ§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ.',
                    features: ['ac', 'bluetooth', 'gps', 'backup_camera', 'cruise_control'],
                    photos: [
                        { filename: 'car1.jpg' },
                        { filename: 'car2.jpg' },
                        { filename: 'car3.jpg' }
                    ]
                };

                // Save car to localStorage
                const existingCars = JSON.parse(localStorage.getItem('mockCars') || '[]');
                const carExists = existingCars.find(c => c.id === testCar.id);
                if (!carExists) {
                    existingCars.push(testCar);
                    localStorage.setItem('mockCars', JSON.stringify(existingCars));
                }

                addDebugInfo('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
                updateDataCounts();

            } catch (error) {
                console.error('âŒ Error creating test data:', error);
                addDebugInfo('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©: ' + error.message);
            }
        }

        // Simulate car details page
        function simulateCarDetails() {
            try {
                // Check if car exists
                const cars = JSON.parse(localStorage.getItem('mockCars') || '[]');
                const car = cars.find(c => c.id === '1');

                if (!car) {
                    addDebugInfo('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©. ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                    return;
                }

                addDebugInfo('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
                addDebugInfo(`ğŸš— Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${car.brand} ${car.model} ${car.year}`);
                addDebugInfo(`ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${car.daily_rate} Ø±ÙŠØ§Ù„`);

                // Simulate booking creation
                const testBooking = {
                    id: Date.now(),
                    car_id: car.id,
                    start_date: '2024-01-15',
                    end_date: '2024-01-18',
                    status: 'pending',
                    total_amount: 450, // 3 days * 150 SAR
                    deposit_amount: car.deposit
                };

                // Save booking to localStorage
                const existingBookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                existingBookings.push(testBooking);
                localStorage.setItem('mockBookings', JSON.stringify(existingBookings));

                addDebugInfo('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² ØªØ¬Ø±ÙŠØ¨ÙŠ');
                addDebugInfo(`ğŸ“… Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®: ${testBooking.start_date} - ${testBooking.end_date}`);
                addDebugInfo(`ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${testBooking.total_amount} Ø±ÙŠØ§Ù„`);
                updateDataCounts();

            } catch (error) {
                console.error('âŒ Error simulating car details:', error);
                addDebugInfo('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø­Ø§ÙƒØ§Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ' + error.message);
            }
        }

        // Test payment redirect
        function testPaymentRedirect() {
            try {
                // Check if booking exists
                const bookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                const latestBooking = bookings[bookings.length - 1];

                if (!latestBooking) {
                    addDebugInfo('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ø£ÙˆÙ„Ø§Ù‹.');
                    return;
                }

                addDebugInfo('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ');
                addDebugInfo(`ğŸ†” Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø¬Ø²: ${latestBooking.id}`);
                addDebugInfo('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹...');

                // Redirect to payment page
                setTimeout(() => {
                    window.location.href = `payment.html?booking_id=${latestBooking.id}`;
                }, 2000);

            } catch (error) {
                console.error('âŒ Error testing payment redirect:', error);
                addDebugInfo('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹: ' + error.message);
            }
        }

        // Update data counts
        function updateDataCounts() {
            try {
                const cars = JSON.parse(localStorage.getItem('mockCars') || '[]');
                const bookings = JSON.parse(localStorage.getItem('mockBookings') || '[]');
                const payments = JSON.parse(localStorage.getItem('mockPayments') || '[]');

                document.getElementById('carsCount').textContent = cars.length;
                document.getElementById('bookingsCount').textContent = bookings.length;
                document.getElementById('paymentsCount').textContent = payments.length;

            } catch (error) {
                console.error('âŒ Error updating data counts:', error);
            }
        }

        // Clear all data
        function clearAllData() {
            try {
                localStorage.removeItem('mockCars');
                localStorage.removeItem('mockBookings');
                localStorage.removeItem('mockPayments');

                addDebugInfo('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
                updateDataCounts();

            } catch (error) {
                console.error('âŒ Error clearing data:', error);
                addDebugInfo('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
            }
        }

        // Add debug info
        function addDebugInfo(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const logEntry = document.createElement('div');
            logEntry.className = 'debug-entry';
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            
            debugInfo.appendChild(logEntry);
            debugInfo.scrollTop = debugInfo.scrollHeight;
            
            console.log(message);
        }
    </script>

    <style>
        .test-steps {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .step-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content h3 {
            margin: 0 0 0.5rem 0;
            color: #374151;
        }

        .step-content p {
            margin: 0 0 1rem 0;
            color: #6b7280;
        }

        .data-section {
            margin-bottom: 3rem;
        }

        .data-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
        }

        .data-card h3 {
            margin: 0 0 1.5rem 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .data-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .debug-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 3rem;
        }

        .debug-section h3 {
            margin: 0 0 1rem 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .debug-content {
            background: #1e1e1e;
            color: #ffffff;
            padding: 1rem;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .debug-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .timestamp {
            color: #10b981;
        }

        .quick-links {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
        }

        .quick-links h3 {
            margin: 0 0 1.5rem 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .link-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            text-decoration: none;
            color: #374151;
            transition: all 0.3s ease;
        }

        .link-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .link-card i {
            font-size: 1.5rem;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .step {
                flex-direction: column;
                text-align: center;
            }
            
            .data-content {
                grid-template-columns: 1fr;
            }
            
            .links-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
