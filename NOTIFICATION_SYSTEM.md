# ูุธุงู ุงูุฅุดุนุงุฑุงุช - ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุฅุดุนุงุฑุงุช ุดุงูู ูุฅุฑุณุงู ุฅุดุนุงุฑุงุช ููุงูู ุงูุณูุงุฑุฉ ุนูุฏ ุฑูุน ุงูุตูุฑ ูู ูุจู ุงููุณุชุฃุฌุฑุ ุจุงูุฅุถุงูุฉ ุฅูู ุฃููุงุน ุฃุฎุฑู ูู ุงูุฅุดุนุงุฑุงุช.

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### ๐ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงููุฏุนููุฉ

1. **ุฑูุน ุงูุตูุฑ** (`photo_uploaded`)
   - ูุชู ุฅุฑุณุงููุง ููุงูู ุงูุณูุงุฑุฉ ุนูุฏ ุฑูุน ุงููุณุชุฃุฌุฑ ููุตูุฑ
   - ุชุญุชูู ุนูู ุชูุงุตูู ุงููุณุชุฃุฌุฑ ูุงูุณูุงุฑุฉ

2. **ุชุญุฏูุซ ุญุงูุฉ ุงูุญุฌุฒ** (`booking_status_updated`)
   - ุฅุดุนุงุฑุงุช ุญูู ุชุบููุฑ ุญุงูุฉ ุงูุญุฌุฒ (ููุงููุฉุ ุฑูุถุ ุฅููุงู)

3. **ุงูุชููููุงุช** (`review_received`)
   - ุฅุดุนุงุฑุงุช ุนูุฏ ุงุณุชูุงู ุชูููู ุฌุฏูุฏ

4. **ุงูุญุฌูุฒุงุช ุงูุฌุฏูุฏุฉ** (`booking_created`)
   - ุฅุดุนุงุฑุงุช ุนูุฏ ุฅูุดุงุก ุญุฌุฒ ุฌุฏูุฏ

5. **ุงูุฏูุน** (`payment_received`)
   - ุฅุดุนุงุฑุงุช ุญูู ุงุณุชูุงู ุงูุฏูุน

### ๐ฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู

- **ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช** (`notifications.html`)
- **ุดุงุฑุฉ ุงูุฅุดุนุงุฑุงุช** ูู ุฌููุน ุงูุตูุญุงุช
- **ููุชุฑุฉ ุงูุฅุดุนุงุฑุงุช** ุญุณุจ ุงูููุน ูุงูุญุงูุฉ
- **ุชุญุฏูุฏ ูููุฑูุก** ููุฅุดุนุงุฑุงุช ุงููุฑุฏูุฉ ูุงูุฌูุงุนูุฉ
- **ุญุฐู ุงูุฅุดุนุงุฑุงุช**

## ุงูุจููุฉ ุงูุชูููุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช (Firebase Realtime Database)

```json
{
  "notifications": {
    "notificationId1": {
      "id": "notificationId1",
      "user_id": "userId",
      "type": "photo_uploaded",
      "title": "ุชู ุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ููุญุฌุฒ",
      "description": "ูุงู ุฃุญูุฏ ูุญูุฏ ุจุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ูุญุฌุฒ ุณูุงุฑุฉ ุชูููุชุง ูุงูุฑู 2023",
      "related_id": "bookingId",
      "related_type": "booking",
      "is_read": false,
      "created_at": "2024-01-15T10:30:00.000Z"
    }
  }
}
```

### API Endpoints

#### 1. ุงูุญุตูู ุนูู ุงูุฅุดุนุงุฑุงุช
```http
GET /api/notifications?limit=20&offset=0
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "notifications": [
    {
      "id": "notificationId",
      "user_id": "userId",
      "type": "photo_uploaded",
      "title": "ุชู ุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ููุญุฌุฒ",
      "description": "ูุงู ุฃุญูุฏ ูุญูุฏ ุจุฑูุน ุตูุฑ ุฌุฏูุฏุฉ...",
      "related_id": "bookingId",
      "related_type": "booking",
      "is_read": false,
      "created_at": "2024-01-15T10:30:00.000Z"
    }
  ]
}
```

#### 2. ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
```http
GET /api/notifications/unread-count
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "count": 5
}
```

#### 3. ุชุญุฏูุฏ ุฅุดุนุงุฑ ูููุฑูุก
```http
PUT /api/notifications/:id/read
Authorization: Bearer <token>
```

#### 4. ุชุญุฏูุฏ ุฌููุน ุงูุฅุดุนุงุฑุงุช ูููุฑูุกุฉ
```http
PUT /api/notifications/mark-all-read
Authorization: Bearer <token>
```

#### 5. ุญุฐู ุฅุดุนุงุฑ
```http
DELETE /api/notifications/:id
Authorization: Bearer <token>
```

### ุฏูุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุฅูุดุงุก ุฅุดุนุงุฑ
```javascript
async createNotification(notificationData) {
  // Creates a new notification in Firebase
}
```

#### ุงูุญุตูู ุนูู ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู
```javascript
async getNotificationsByUserId(userId, limit = 20) {
  // Retrieves notifications for a specific user
}
```

#### ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
```javascript
async getUnreadNotificationsCount(userId) {
  // Returns count of unread notifications
}
```

#### ุชุญุฏูุฏ ูููุฑูุก
```javascript
async markNotificationAsRead(notificationId) {
  // Marks a single notification as read
}

async markAllNotificationsAsRead(userId) {
  // Marks all user notifications as read
}
```

## ุขููุฉ ุนูู ุฅุดุนุงุฑุงุช ุฑูุน ุงูุตูุฑ

### 1. ุนูุฏ ุฑูุน ุงูุตูุฑ
```javascript
// ูู ุฏุงูุฉ saveBookingPhoto
await this.createPhotoUploadNotification(bookingId, photo);
```

### 2. ุฅูุดุงุก ุงูุฅุดุนุงุฑ
```javascript
async createPhotoUploadNotification(bookingId, photo) {
  // 1. ุงูุญุตูู ุนูู ุชูุงุตูู ุงูุญุฌุฒ
  const booking = await this.getBookingById(bookingId);
  
  // 2. ุงูุญุตูู ุนูู ุชูุงุตูู ุงูุณูุงุฑุฉ
  const car = await this.getCarById(booking.car_id);
  
  // 3. ุงูุญุตูู ุนูู ุชูุงุตูู ุงููุณุชุฃุฌุฑ
  const renter = await this.getUserById(booking.renter_id);
  
  // 4. ุฅูุดุงุก ุงูุฅุดุนุงุฑ ููุงูู ุงูุณูุงุฑุฉ
  const notificationData = {
    user_id: booking.owner_id,
    type: 'photo_uploaded',
    title: 'ุชู ุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ููุญุฌุฒ',
    description: `ูุงู ${renter.full_name} ุจุฑูุน ุตูุฑ ุฌุฏูุฏุฉ ูุญุฌุฒ ุณูุงุฑุฉ ${car.brand} ${car.model} ${car.year}`,
    related_id: bookingId,
    related_type: 'booking'
  };
  
  await this.createNotification(notificationData);
}
```

## ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช
- **ุงูุนููุงู**: `notifications.html`
- **ุงูููู ุงููุณุงุนุฏ**: `notifications.js`
- **ุงูุชุตููู**: `styles.css`

### ุงูููุฒุงุช
1. **ุนุฑุถ ุงูุฅุดุนุงุฑุงุช** ูุน ุฃููููุงุช ูุฎุชููุฉ ุญุณุจ ุงูููุน
2. **ููุชุฑุฉ ุงูุฅุดุนุงุฑุงุช** (ุงูููุ ุบูุฑ ููุฑูุกุฉุ ุญุณุจ ุงูููุน)
3. **ุชุญุฏูุฏ ูููุฑูุก** (ูุฑุฏู ุฃู ุฌูุงุนู)
4. **ุญุฐู ุงูุฅุดุนุงุฑุงุช**
5. **ุชุญููู ุงููุฒูุฏ** ูู ุงูุฅุดุนุงุฑุงุช
6. **ุดุงุฑุฉ ุงูุฅุดุนุงุฑุงุช** ูู ุฌููุน ุงูุตูุญุงุช

### ุดุงุฑุฉ ุงูุฅุดุนุงุฑุงุช
```html
<a href="notifications.html">
    <i class="fas fa-bell"></i>
    ุงูุฅุดุนุงุฑุงุช
    <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
</a>
```

## ุงูุงุฎุชุจุงุฑ

### ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงููุธุงู
```bash
npm run test-notifications
```

### ุงุฎุชุจุงุฑุงุช ุดุงููุฉ
1. **ุฅูุดุงุก ุงูุฅุดุนุงุฑุงุช**
2. **ุงูุญุตูู ุนูู ุงูุฅุดุนุงุฑุงุช**
3. **ุชุญุฏูุฏ ูููุฑูุก**
4. **ุญุณุงุจ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ**
5. **ุฅุดุนุงุฑุงุช ุฑูุน ุงูุตูุฑ**

## ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- ุฌููุน API endpoints ุชุชุทูุจ ูุตุงุฏูุฉ JWT
- ุงููุณุชุฎุฏู ููููู ุงููุตูู ููุท ูุฅุดุนุงุฑุงุชู ุงูุฎุงุตุฉ
- ุงูุชุญูู ูู ููููุฉ ุงูุฅุดุนุงุฑ ูุจู ุงูุชุญุฏูุซ ุฃู ุงูุญุฐู

### ุญูุงูุฉ ุงูุจูุงูุงุช
- ูุง ูุชู ุชุฎุฒูู ูุนูููุงุช ุญุณุงุณุฉ ูู ุงูุฅุดุนุงุฑุงุช
- ุงุณุชุฎุฏุงู ูุนุฑูุงุช ูุฑุฌุนูุฉ ููุจูุงูุงุช ุงููุฑุชุจุทุฉ
- ุชุดููุฑ ุงูุจูุงูุงุช ูู ุงูููู

## ุงูุฃุฏุงุก ูุงูุชุญุณูู

### ุชุญุณููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ููุฑุณุฉ** ุนูู `user_id` ููุงุณุชุนูุงูุงุช ุงูุณุฑูุนุฉ
- **ุชุฑุชูุจ** ุญุณุจ `created_at` ููุฅุดุนุงุฑุงุช ุงูุฃุญุฏุซ
- **ุญุฏ** ุนูู ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุญููุฉ

### ุชุญุณููุงุช ุงููุงุฌูุฉ
- **ุชุญููู ุชุฏุฑูุฌู** ููุฅุดุนุงุฑุงุช
- **ุชุญุฏูุซ ููุฑู** ูุดุงุฑุฉ ุงูุฅุดุนุงุฑุงุช
- **ุชุฎุฒูู ูุคูุช** ููุจูุงูุงุช ุงููุญููุฉ

## ุงูุชุทููุฑ ุงููุณุชูุจูู

### ููุฒุงุช ููุชุฑุญุฉ
1. **ุฅุดุนุงุฑุงุช ููุฑูุฉ** (WebSocket/Push Notifications)
2. **ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช** (ุชูุถููุงุช ุงููุณุชุฎุฏู)
3. **ุฅุดุนุงุฑุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**
4. **ุฅุดุนุงุฑุงุช SMS**
5. **ุฌุฏููุฉ ุงูุฅุดุนุงุฑุงุช**

### ุชุญุณููุงุช ุชูููุฉ
1. **WebSocket** ููุงุชุตุงู ุงููุจุงุดุฑ
2. **Service Workers** ููุฅุดุนุงุฑุงุช ูู ุงููุชุตูุญ
3. **Firebase Cloud Messaging** ููุฅุดุนุงุฑุงุช ุงูููุฑูุฉ
4. **ุชุญูููุงุช ุงูุฅุดุนุงุฑุงุช** (ูุนุฏู ุงููุชุญุ ุงูุชูุงุนู)

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ

#### 1. ุนุฏู ุธููุฑ ุงูุฅุดุนุงุฑุงุช
- ุชุญูู ูู ูุฌูุฏ token ุตุงูุญ
- ุชุญูู ูู ุงุชุตุงู Firebase
- ุชุญูู ูู console ููุฃุฎุทุงุก

#### 2. ุนุฏู ุชุญุฏูุซ ุดุงุฑุฉ ุงูุฅุดุนุงุฑุงุช
- ุชุญูู ูู ุฏุงูุฉ `updateNotificationBadge()`
- ุชุญูู ูู ูุฌูุฏ ุนูุตุฑ `notificationBadge`
- ุชุญูู ูู ุงุณุชุฌุงุจุฉ API

#### 3. ุนุฏู ุฅูุดุงุก ุฅุดุนุงุฑุงุช ุฑูุน ุงูุตูุฑ
- ุชุญูู ูู ูุฌูุฏ ุจูุงูุงุช ุงูุญุฌุฒ ูุงูุณูุงุฑุฉ ูุงููุณุชุฎุฏู
- ุชุญูู ูู console ููุฃุฎุทุงุก ูู `createPhotoUploadNotification`
- ุชุญูู ูู ุตูุงุญูุงุช Firebase

### ุณุฌูุงุช ุงูุชุตุญูุญ
```javascript
// ุชูุนูู ุณุฌูุงุช ููุตูุฉ
console.log('Photo upload notification created for car owner:', booking.owner_id);
console.error('Error creating photo upload notification:', error);
```

## ุงูุฎูุงุตุฉ

ุชู ุชุทููุฑ ูุธุงู ุฅุดุนุงุฑุงุช ุดุงูู ููุชูุงูู ูููุฑ:

โ **ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ** ุนูุฏ ุฑูุน ุงูุตูุฑ  
โ **ูุงุฌูุฉ ูุณุชุฎุฏู ุจุฏูููุฉ** ูุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช  
โ **API ููู ูุขูู** ููุชุนุงูู ูุน ุงูุฅุดุนุงุฑุงุช  
โ **ุฃุฏุงุก ูุญุณู** ูุน Firebase Realtime Database  
โ **ุงุฎุชุจุงุฑุงุช ุดุงููุฉ** ูุถูุงู ุงูุฌูุฏุฉ  
โ **ุชูุซูู ููุตู** ููุชุทููุฑ ูุงูุตูุงูุฉ  

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ููููู ุชูุณูุนู ุจุณูููุฉ ูุฅุถุงูุฉ ุฃููุงุน ุฌุฏูุฏุฉ ูู ุงูุฅุดุนุงุฑุงุช ูุงูููุฒุงุช ุงููุชูุฏูุฉ.
