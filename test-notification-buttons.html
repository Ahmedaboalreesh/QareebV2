<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุฃุฒุฑุงุฑ ุงูุฅุดุนุงุฑุงุช - ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <i class="fas fa-car"></i>
                        <span>ููุตุฉ ุชุฃุฌูุฑ ุงูุณูุงุฑุงุช</span>
                    </a>
                </div>
                <nav class="nav">
                    <a href="notifications.html">
                        <i class="fas fa-bell"></i>
                        ุงูุนูุฏุฉ ููุฅุดุนุงุฑุงุช
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>
                    <i class="fas fa-bug"></i>
                    ุงุฎุชุจุงุฑ ุฃุฒุฑุงุฑ ุงูุฅุดุนุงุฑุงุช
                </h1>
                <p>ุตูุญุฉ ูุฎุตุตุฉ ูุงุฎุชุจุงุฑ ุนูู ุฃุฒุฑุงุฑ ุงูุฅุดุนุงุฑุงุช</p>
            </div>

            <!-- Test Controls -->
            <div class="notifications-controls">
                <div class="controls-left">
                    <button class="btn btn-outline" onclick="createTestNotification()">
                        <i class="fas fa-plus"></i>
                        ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฌุฑูุจู
                    </button>
                    <button class="btn btn-outline" onclick="clearTestData()">
                        <i class="fas fa-trash"></i>
                        ูุณุญ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
                    </button>
                </div>
                <div class="controls-right">
                    <button class="btn btn-outline" onclick="testAllButtons()">
                        <i class="fas fa-play"></i>
                        ุงุฎุชุจุงุฑ ุฌููุน ุงูุฃุฒุฑุงุฑ
                    </button>
                </div>
            </div>

            <!-- Test Notifications List -->
            <div class="notifications-container">
                <div class="notifications-list" id="testNotificationsList">
                    <!-- Test notifications will be loaded here -->
                </div>
            </div>

            <!-- Debug Info -->
            <div class="debug-info" style="background: white; padding: 1rem; border-radius: 8px; margin-top: 2rem;">
                <h3>ูุนูููุงุช ุงูุชุตุญูุญ:</h3>
                <div id="debugLog" style="background: #f8f9fa; padding: 1rem; border-radius: 4px; font-family: monospace; font-size: 0.9rem; max-height: 300px; overflow-y: auto;">
                    ุฌุงุฑู ุชุญููู ูุนูููุงุช ุงูุชุตุญูุญ...
                </div>
            </div>
        </div>
    </section>

    <!-- Notification Item Template -->
    <template id="notificationTemplate">
        <div class="notification-item" data-id="">
            <div class="notification-icon">
                <i class="fas fa-bell"></i>
            </div>
            <div class="notification-content">
                <div class="notification-header">
                    <h4 class="notification-title"></h4>
                    <div class="notification-actions">
                        <button class="btn-icon btn-view" onclick="viewNotificationSource(this)" title="ุนุฑุถ ุงููุตุฏุฑ">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        <button class="btn-icon" onclick="markAsRead(this)" title="ุชุญุฏูุฏ ูููุฑูุก">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn-icon" onclick="deleteNotification(this)" title="ุญุฐู">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <p class="notification-description"></p>
                <div class="notification-meta">
                    <span class="notification-time"></span>
                    <span class="notification-type"></span>
                </div>
            </div>
            <div class="notification-status">
                <div class="unread-indicator"></div>
            </div>
        </div>
    </template>

    <script>
        // Global variables
        let testNotifications = [];
        let debugLog = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('๐ง Initializing notification buttons test page...');
            addDebugLog('๐ง ุชู ุชููุฆุฉ ุตูุญุฉ ุงุฎุชุจุงุฑ ุฃุฒุฑุงุฑ ุงูุฅุดุนุงุฑุงุช');
            
            // Load test notifications
            loadTestNotifications();
            
            addDebugLog('โ ุชู ุชุญููู ุงูุฅุดุนุงุฑุงุช ุงูุชุฌุฑูุจูุฉ');
        });

        // Add debug log
        function addDebugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            
            const debugElement = document.getElementById('debugLog');
            if (debugElement) {
                debugElement.innerHTML = debugLog.map(log => `<div>${log}</div>`).join('');
                debugElement.scrollTop = debugElement.scrollHeight;
            }
            
            console.log(message);
        }

        // Load test notifications
        function loadTestNotifications() {
            try {
                const notificationsList = document.getElementById('testNotificationsList');
                
                // Get mock notifications from localStorage
                const mockNotifications = JSON.parse(localStorage.getItem('mockNotifications') || '[]');
                
                if (mockNotifications.length === 0) {
                    notificationsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-bell-slash"></i>
                            </div>
                            <h3>ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ</h3>
                            <p>ุงุถุบุท ุนูู "ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฌุฑูุจู" ูุจุฏุก ุงูุงุฎุชุจุงุฑ</p>
                        </div>
                    `;
                    addDebugLog('โ๏ธ ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช ุชุฌุฑูุจูุฉ');
                    return;
                }
                
                testNotifications = mockNotifications;
                displayTestNotifications();
                addDebugLog(`โ ุชู ุชุญููู ${mockNotifications.length} ุฅุดุนุงุฑ ุชุฌุฑูุจู`);
                
            } catch (error) {
                console.error('โ Error loading test notifications:', error);
                addDebugLog(`โ ุฎุทุฃ ูู ุชุญููู ุงูุฅุดุนุงุฑุงุช: ${error.message}`);
            }
        }

        // Display test notifications
        function displayTestNotifications() {
            const notificationsList = document.getElementById('testNotificationsList');
            notificationsList.innerHTML = '';
            
            testNotifications.forEach(notification => {
                const notificationElement = createTestNotificationElement(notification);
                notificationsList.appendChild(notificationElement);
            });
            
            addDebugLog(`๐ ุชู ุนุฑุถ ${testNotifications.length} ุฅุดุนุงุฑ`);
        }

        // Create test notification element
        function createTestNotificationElement(notification) {
            const template = document.getElementById('notificationTemplate');
            const notificationElement = template.content.cloneNode(true);
            
            const notificationItem = notificationElement.querySelector('.notification-item');
            const icon = notificationElement.querySelector('.notification-icon i');
            const title = notificationElement.querySelector('.notification-title');
            const description = notificationElement.querySelector('.notification-description');
            const time = notificationElement.querySelector('.notification-time');
            const type = notificationElement.querySelector('.notification-type');
            const unreadIndicator = notificationElement.querySelector('.unread-indicator');
            
            // Set notification ID
            notificationItem.setAttribute('data-id', notification.id);
            
            // Set icon based on type
            const iconMap = {
                'photo_uploaded': 'fas fa-camera',
                'booking_status_updated': 'fas fa-calendar-check',
                'review_received': 'fas fa-star',
                'booking_created': 'fas fa-calendar-plus',
                'payment_received': 'fas fa-money-bill-wave'
            };
            
            icon.className = iconMap[notification.type] || 'fas fa-bell';
            
            // Set content
            title.textContent = notification.title;
            description.textContent = notification.description;
            time.textContent = formatTime(notification.created_at);
            type.textContent = getNotificationTypeText(notification.type);
            
            // Set unread indicator
            if (!notification.is_read) {
                unreadIndicator.style.display = 'block';
                notificationItem.classList.add('unread');
            } else {
                unreadIndicator.style.display = 'none';
                notificationItem.classList.remove('unread');
            }
            
            // Add event listeners for buttons
            const viewButton = notificationElement.querySelector('.btn-view');
            const markReadButton = notificationElement.querySelector('.btn-icon:not(.btn-view)');
            const deleteButton = notificationElement.querySelector('.btn-icon:last-child');
            
            if (viewButton) {
                viewButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    addDebugLog(`๐ ุชู ุงูููุฑ ุนูู ุฒุฑ "ุนุฑุถ ุงููุตุฏุฑ" ููุฅุดุนุงุฑ: ${notification.id}`);
                    testViewNotificationSource(this);
                });
            }
            
            if (markReadButton) {
                markReadButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    addDebugLog(`โ ุชู ุงูููุฑ ุนูู ุฒุฑ "ุชุญุฏูุฏ ูููุฑูุก" ููุฅุดุนุงุฑ: ${notification.id}`);
                    testMarkAsRead(this);
                });
            }
            
            if (deleteButton) {
                deleteButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    addDebugLog(`๐๏ธ ุชู ุงูููุฑ ุนูู ุฒุฑ "ุญุฐู" ููุฅุดุนุงุฑ: ${notification.id}`);
                    testDeleteNotification(this);
                });
            }
            
            return notificationElement;
        }

        // Test functions
        function testViewNotificationSource(button) {
            const notificationItem = button.closest('.notification-item');
            const notificationId = notificationItem.getAttribute('data-id');
            
            addDebugLog(`๐ ุงุฎุชุจุงุฑ ุฒุฑ ุนุฑุถ ุงููุตุฏุฑ - ูุนุฑู ุงูุฅุดุนุงุฑ: ${notificationId}`);
            
            // Simulate navigation
            setTimeout(() => {
                addDebugLog(`โ ุชู ูุญุงูุงุฉ ุงูุงูุชูุงู ุฅูู ุงููุตุฏุฑ ููุฅุดุนุงุฑ: ${notificationId}`);
            }, 1000);
        }

        function testMarkAsRead(button) {
            const notificationItem = button.closest('.notification-item');
            const notificationId = notificationItem.getAttribute('data-id');
            
            addDebugLog(`โ ุงุฎุชุจุงุฑ ุฒุฑ ุชุญุฏูุฏ ูููุฑูุก - ูุนุฑู ุงูุฅุดุนุงุฑ: ${notificationId}`);
            
            // Update UI
            notificationItem.classList.remove('unread');
            const unreadIndicator = notificationItem.querySelector('.unread-indicator');
            if (unreadIndicator) {
                unreadIndicator.style.display = 'none';
            }
            
            // Update notification in array
            const notification = testNotifications.find(n => n.id === notificationId);
            if (notification) {
                notification.is_read = true;
            }
            
            addDebugLog(`โ ุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุฅุดุนุงุฑ ุฅูู ููุฑูุก: ${notificationId}`);
        }

        function testDeleteNotification(button) {
            const notificationItem = button.closest('.notification-item');
            const notificationId = notificationItem.getAttribute('data-id');
            
            addDebugLog(`๐๏ธ ุงุฎุชุจุงุฑ ุฒุฑ ุงูุญุฐู - ูุนุฑู ุงูุฅุดุนุงุฑ: ${notificationId}`);
            
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุฅุดุนุงุฑ ุงูุชุฌุฑูุจูุ')) {
                // Remove from array
                testNotifications = testNotifications.filter(n => n.id !== notificationId);
                
                // Remove from UI
                notificationItem.remove();
                
                addDebugLog(`โ ุชู ุญุฐู ุงูุฅุดุนุงุฑ ุงูุชุฌุฑูุจู: ${notificationId}`);
            } else {
                addDebugLog(`โ ุชู ุฅูุบุงุก ุญุฐู ุงูุฅุดุนุงุฑ: ${notificationId}`);
            }
        }

        // Utility functions
        function formatTime(timestamp) {
            const now = new Date();
            const notificationTime = new Date(timestamp);
            const diffInMinutes = Math.floor((now - notificationTime) / (1000 * 60));
            
            if (diffInMinutes < 1) {
                return 'ุงูุขู';
            } else if (diffInMinutes < 60) {
                return `ููุฐ ${diffInMinutes} ุฏูููุฉ`;
            } else if (diffInMinutes < 1440) {
                const hours = Math.floor(diffInMinutes / 60);
                return `ููุฐ ${hours} ุณุงุนุฉ`;
            } else {
                const days = Math.floor(diffInMinutes / 1440);
                return `ููุฐ ${days} ููู`;
            }
        }

        function getNotificationTypeText(type) {
            const typeMap = {
                'photo_uploaded': 'ุฑูุน ุงูุตูุฑ',
                'booking_status_updated': 'ุชุญุฏูุซ ุงูุญุฌุฒ',
                'review_received': 'ุงูุชููููุงุช',
                'booking_created': 'ุญุฌุฒ ุฌุฏูุฏ',
                'payment_received': 'ุงูุฏูุน'
            };
            
            return typeMap[type] || type;
        }

        // Control functions
        function createTestNotification() {
            const testNotification = {
                id: `test-${Date.now()}`,
                user_id: 'test-user',
                type: 'photo_uploaded',
                title: 'ุฅุดุนุงุฑ ุชุฌุฑูุจู ุฌุฏูุฏ',
                description: 'ูุฐุง ุฅุดุนุงุฑ ุชุฌุฑูุจู ูุงุฎุชุจุงุฑ ุงูุฃุฒุฑุงุฑ',
                related_id: 'test-booking',
                related_type: 'booking',
                is_read: false,
                created_at: new Date().toISOString(),
                car_name: 'ุณูุงุฑุฉ ุชุฌุฑูุจูุฉ',
                renter_name: 'ูุณุชุฎุฏู ุชุฌุฑูุจู'
            };
            
            testNotifications.unshift(testNotification);
            displayTestNotifications();
            
            addDebugLog(`โ ุชู ุฅูุดุงุก ุฅุดุนุงุฑ ุชุฌุฑูุจู ุฌุฏูุฏ: ${testNotification.id}`);
        }

        function clearTestData() {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ูุณุญ ุฌููุน ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉุ')) {
                testNotifications = [];
                displayTestNotifications();
                addDebugLog('๐๏ธ ุชู ูุณุญ ุฌููุน ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ');
            }
        }

        function testAllButtons() {
            addDebugLog('๐งช ุจุฏุก ุงุฎุชุจุงุฑ ุฌููุน ุงูุฃุฒุฑุงุฑ...');
            
            const buttons = document.querySelectorAll('.btn-icon');
            addDebugLog(`๐ ุชู ุงูุนุซูุฑ ุนูู ${buttons.length} ุฒุฑ`);
            
            buttons.forEach((button, index) => {
                setTimeout(() => {
                    addDebugLog(`๐ ุงุฎุชุจุงุฑ ุงูุฒุฑ ุฑูู ${index + 1}: ${button.title || 'ุฒุฑ ุจุฏูู ุนููุงู'}`);
                    button.style.transform = 'scale(1.1)';
                    button.style.backgroundColor = '#ffeb3b';
                    
                    setTimeout(() => {
                        button.style.transform = '';
                        button.style.backgroundColor = '';
                    }, 500);
                }, index * 200);
            });
        }
    </script>
</body>
</html>
